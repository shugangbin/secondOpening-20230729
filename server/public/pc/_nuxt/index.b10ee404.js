import{_ as O}from"./layout.6eb0f29a.js";import{E as q}from"./index.7ded7c66.js";import{E as F}from"./keyword-suggestion.b6027bde.js";import{a as G,ab as J,a7 as Q,a9 as W,r as _,ac as S,aj as X,ak as Y,u as L,o as m,c as w,e as l,h as s,k as U,K as j,L as A,f as p,i as K,l as h,t as N,ad as b,ae as Z,ag as ee,ah as te}from"./entry.47644ad8.js";/* empty css                        */import{d as ae,a as re,b as oe,c as se}from"./drawing.e1203c85.js";import{u as ie}from"./usePolling.9af4c0ec.js";import{useSplit as ne}from"./useSplit.160797bf.js";import le from"./index.b6a97ed1.js";import{_ as ce}from"./model-picker.vue.4716d004.js";import ue from"./drawing-record.c12c2445.js";import me from"./drawing-picture.24c9510a.js";import pe from"./drawing-property.092f6396.js";import de from"./drawing-loading.46992a4a.js";import{_ as ge}from"./_plugin-vue_export-helper.c27b6911.js";import"./throttle.a2b1ebd6.js";import"./debounce.ad6365f0.js";import"./position.0a5dfbe0.js";import"./index.fa6b8d9e.js";import"./strings.6f89bc4f.js";import"./index.d4237e01.js";import"./index.5f1ada03.js";import"./index.53e0169a.js";import"./use-dialog.c1a38897.js";import"./refs.1a6521b3.js";/* empty css                     *//* empty css                  */import"./index.fd4342e5.js";/* empty css                *//* empty css                  */import"./index.1d02bbbe.js";import"./useLockFn.20997974.js";import"./index.749efd5f.js";import"./_baseClone.7cdf9853.js";import"./_getTag.ff85c21b.js";import"./isEqual.1f1c08b1.js";import"./index.d4d0012e.js";import"./dropdown.515293b4.js";/* empty css                    */import"./index.dd38e81b.js";import"./icon_unselect.c70af18d.js";import"./index.e6e865f4.js";/* empty css                   */const _e=""+new URL("drawing_empty.c24592f8.png",import.meta.url).href,fe=f=>(ee("data-v-a092f91d"),f=f(),te(),f),ve=fe(()=>s("div",{class:"w-full h-full bg-white rounded-[6px] flex items-center justify-center"},[s("div",{class:"text-xl"},"绘画功能未开启!")],-1)),we={class:"drawing-left bg-white w-[350px] h-full px-[15px] py-[20px]"},he={class:"selector"},ye={class:"pt-[20px] h-full",style:{height:"calc(100% - 40px)"}},xe={class:"drawing-main h-full flex"},De={key:0,class:"flex items-center justify-center w-full h-full"},ke={class:"text-xl"},Re={class:"text-info"},Se={key:0,class:"drawing-right bg-white h-full w-[330px] rounded-[10px]"},be=G({__name:"index",setup(f){const $=J(),M=Q(),y=W(),n=_(0),r=_(!1),x=_(""),d=_(!1),o=S({current:0,lists:[]}),D=_(0),t=S({actions:[],prompt:"",status:"",fail_reason:"",prompt_en:"",task_id:"",image_id:"",image_url:""}),C={prompt:"",action:"generate",image_base:"",image_id:"",scale:"1:1"},k=S(C),P=a=>{const e=async()=>{try{const u=await se({records_id:a.value});return Reflect.ownKeys(u).map(B=>{t[B]=u[B]}),o.lists[0]=t,(u.status==3||u.status==2)&&(g(),c()),u}catch(u){g(),console.log("获取详情失败=>",u)}},c=async()=>{await v(),r.value=!1,o.current=0,await y.getUser()},{start:R,end:g,result:i}=ie(e,{totalTime:48e4,time:5e3,count:96,callback:c});return{start:R,end:g,result:i}},{start:E,end:T}=P(D);X(()=>{T()});const H=a=>{Reflect.ownKeys(a).map(e=>{t[e]=a[e]})},v=async()=>{try{const a=await ae({});a.length!=0&&Reflect.ownKeys(a[0]).map(e=>{t[e]=a[0][e]}),o.lists=a,t.status==1&&(r.value=!0,D.value=t.id,n.value=0,E()),console.log(t)}catch(a){console.log("获取绘画记录失败=>",a)}},I=async a=>{if(!a.length){b.msgError("请选择需要删除的图片");return}try{await re({ids:a}),b.msgSuccess("删除成功"),await v()}catch(e){console.log("删除失败绘画记录",e)}},z=async a=>{if(!(d.value||Array.isArray(t.image_url))){d.value=!0;try{const{getImages:e}=ne(a,{columns:2,rows:2}),c=await e();t.image_url=c,d.value=!1}catch(e){d.value=!1,console.log("一键切图失败=>",e)}}},V=async a=>{if(!r.value){if(!y.isLogin)return y.toggleShowLogin(!0);if(!a.drawing.prompt)return b.msgError("请输入绘画描述！");r.value=!0,n.value=1,o.current=0,t.image_url="",o.lists.unshift({...t,image_url:""});try{const{records_id:e}=await oe({...a.drawing,model:x.value});a.isClear&&Object.assign(k,C),D.value=e,E()}catch(e){if(o.lists.splice(0,1),o.current=-1,e==="余额不足"){await Z.confirm("绘画余额不足，请前往充值","绘画余额不足",{confirmButtonText:"前往充值",cancelButtonText:"取消",type:"warning"}),$.push("/recharge");return}console.log("绘制失败=>",e),t.fail_reason=e,await v(),r.value=!1}}};return Y(()=>{v()}),(a,e)=>{const c=O,R=q,g=F;return L(M).getDrawConfig.is_open?(m(),w(c,{key:1,name:"default"},{panel:l(()=>[s("div",we,[s("div",he,[s("div",{class:U(["selector__item",{selector__item_active:n.value==0}]),onClick:e[0]||(e[0]=i=>n.value=0)}," AI绘画 ",2),s("div",{class:U(["selector__item",{selector__item_active:n.value==1}]),onClick:e[1]||(e[1]=i=>n.value=1)}," 绘画记录 ",2)]),s("div",ye,[j(p(le,{modelValue:k,"onUpdate:modelValue":e[3]||(e[3]=i=>k=i),isReceiving:r.value,onDrawing:V},{model:l(()=>[p(ce,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=i=>x.value=i)},null,8,["modelValue"])]),_:1},8,["modelValue","isReceiving"]),[[A,n.value==0]]),j(p(ue,{current:o.current,"onUpdate:current":e[4]||(e[4]=i=>o.current=i),"content-list":o.lists,isReceiving:r.value,onChange:H,onDelete:I},null,8,["current","content-list","isReceiving"]),[[A,n.value==1]])])])]),mainRight:l(()=>[!r.value&&t.prompt?(m(),K("div",Se,[p(pe,{formData:t,onDrawing:V,onDelete:I,onSplit:z},null,8,["formData"])])):h("",!0)]),default:l(()=>[s("div",xe,[!r.value&&!t.image_url?(m(),K("div",De,[p(g,null,{icon:l(()=>[p(R,{src:L(_e)},null,8,["src"])]),title:l(()=>[s("div",ke,N(t.fail_reason?"发生错误":"生成的图片将会显示在这里   "),1)]),"sub-title":l(()=>[s("div",Re,N(t.fail_reason?`错误信息：${t.fail_reason}`:"在左侧输入描述，创建你的作品吧!"),1)]),_:1})])):h("",!0),r.value?(m(),w(de,{key:1,picture:t.image_url},null,8,["picture"])):h("",!0),!r.value&&t.image_url?(m(),w(me,{key:2,loading:d.value,picture:t.image_url},null,8,["loading","picture"])):h("",!0)])]),_:1})):(m(),w(c,{key:0,name:"default"},{default:l(()=>[ve]),_:1}))}}});const ft=ge(be,[["__scopeId","data-v-a092f91d"]]);export{ft as default};
