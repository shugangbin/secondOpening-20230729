import{a as z,r as U,b as M,v as H,o as c,i as d,f as m,h as r,u as n,c as ne,a2 as K,t as q,F as S,l as J,k as ie,a3 as le,aG as Q,a9 as Y,ad as P,e as I,H as ce,j as W,a8 as re,ag as ue,ah as de,a7 as pe,ab as me,aa as _e,w as R,ak as fe,aH as X,a0 as N,ae as ve}from"./entry.47644ad8.js";import{E as ge}from"./index.5f1ada03.js";import{_ as Z}from"./index.vue.758401c0.js";/* empty css                     */import{u as xe}from"./useLockFn.20997974.js";import{d as he,e as ye,f as we,h as Ce,i as ke,b as Le,c as Se,s as Ie,g as $e}from"./model-picker.vue.156c1490.js";import{_ as ee}from"./_plugin-vue_export-helper.c27b6911.js";import{_ as Ee}from"./chatting.593544d3.js";import{_ as be}from"./layout.6eb0f29a.js";import{u as F}from"./asyncData.66979bec.js";import"./_commonjsHelpers.042e6b4d.js";import"./index.1d02bbbe.js";import"./client-only.50432bec.js";import"./index.d4d0012e.js";import"./index.fd4342e5.js";import"./dropdown.515293b4.js";import"./refs.1a6521b3.js";/* empty css                *//* empty css                    *//* empty css                  */import"./index.2d38d06b.js";import"./my.94b48df2.js";const Ve={class:"ml-[10px] flex-1 min-w-0"},Ae={key:1,class:"line-clamp-1"},Be=z({__name:"item",props:{modelValue:{},name:{},itemId:{}},emits:["update:modelValue","edit","delete"],setup(_,{emit:e}){const s=_,i=U(""),l=U(!1),h=M({get(){return s.modelValue},set(a){e("update:modelValue",a)}}),p=M(()=>h.value===s.itemId),f=()=>{l.value=!1,e("edit",s.itemId,i.value)};return H(()=>s.modelValue,()=>{l.value=!1}),H(()=>s.name,a=>{i.value=a},{immediate:!0}),(a,u)=>{const t=Z,g=le;return c(),d("div",{class:ie(["px-[10px] h-[40px] flex items-center rounded-[8px] mb-[10px] cursor-pointer",{"bg-page":n(p)}]),onClick:u[4]||(u[4]=x=>h.value=a.itemId)},[m(t,{name:"el-icon-ChatDotRound"}),r("div",Ve,[n(l)?(c(),ne(g,{key:0,modelValue:n(i),"onUpdate:modelValue":u[0]||(u[0]=x=>K(i)?i.value=x:null),size:"small"},null,8,["modelValue"])):(c(),d("div",Ae,q(a.name),1))]),n(p)?(c(),d(S,{key:0},[n(l)?(c(),d(S,{key:0},[r("div",{class:"cursor-pointer mr-[6px] flex",onClick:f},[m(t,{name:"el-icon-Select"})]),r("div",{class:"cursor-pointer flex",onClick:u[1]||(u[1]=x=>l.value=!1)},[m(t,{name:"el-icon-CloseBold"})])],64)):(c(),d(S,{key:1},[r("div",{class:"cursor-pointer mr-[6px] flex",onClick:u[2]||(u[2]=x=>l.value=!0)},[m(t,{name:"el-icon-EditPen"})]),r("div",{class:"cursor-pointer flex",onClick:u[3]||(u[3]=x=>e("delete",a.itemId))},[m(t,{name:"el-icon-Delete"})])],64))],64)):J("",!0)],2)}}});function te(){const _=Q(()=>0,"$RLLxW58MNg"),e=Q(()=>[],"$HnitLJ58Ut"),s=async()=>{const t=await he({page_type:0});return e.value=(t==null?void 0:t.lists)||[],_.value===0&&a(),e.value},i=Y(),l=async()=>{if(!i.isLogin)return i.toggleShowLogin(!0);await ye({}),await s(),a()},h=async t=>{await P.confirm("确定删除该会话？"),await we({id:t}),await s(),a()},p=async()=>{if(!i.isLogin)return i.toggleShowLogin(!0);await P.confirm("确定清除所有会话？"),await Ce(),await s(),a()},f=async(t,g)=>{await ke({id:t,name:g}),s()},a=()=>{var t;_.value=((t=e.value[0])==null?void 0:t.id)||0},u=M(()=>{var t;return((t=e.value.find(g=>g.id===_.value))==null?void 0:t.name)||""});return{getSessionLists:s,sessionActive:_,sessionLists:e,sessionAdd:l,sessionEdit:f,sessionDelete:h,sessionClear:p,currentSession:u}}const De=_=>(ue("data-v-911c7d1f"),_=_(),de(),_),Te={class:"session flex flex-col bg-white"},Re={class:"p-[16px]"},Ne={class:"flex-1 min-h-0"},qe={class:"px-[16px]"},Ue={class:"p-[16px]"},Pe=De(()=>r("span",{class:"ml-[10px]"},"清除所有会话",-1)),je=z({__name:"index",setup(_){const{sessionLists:e,sessionAdd:s,sessionEdit:i,sessionDelete:l,sessionClear:h,sessionActive:p}=te(),{lockFn:f,isLock:a}=xe(async()=>{await s()});return(u,t)=>{const g=re,x=ge,j=Z;return c(),d("div",Te,[r("div",Re,[m(g,{type:"primary",class:"w-full !h-[40px] !border-none !rounded-[8px]",loading:n(a),style:{background:`linear-gradient(
                        90deg,
                        var(--gradient-1) 0%,
                        var(--gradient-2) 100%
                    )`},onClick:n(f)},{default:I(()=>[ce(" + 新建会话 ")]),_:1},8,["loading","onClick"])]),r("div",Ne,[m(x,null,{default:I(()=>[r("div",qe,[(c(!0),d(S,null,W(n(e),o=>(c(),d("div",{key:o.id},[m(Be,{modelValue:n(p),"onUpdate:modelValue":t[0]||(t[0]=$=>K(p)?p.value=$:null),"item-id":o.id,name:o.name,onEdit:n(i),onDelete:n(l)},null,8,["modelValue","item-id","name","onEdit","onDelete"])]))),128))])]),_:1})]),r("div",Ue,[m(g,{class:"w-full",onClick:n(h)},{default:I(()=>[m(j,{name:"el-icon-Delete"}),Pe]),_:1},8,["onClick"])])])}}});const Fe=ee(je,[["__scopeId","data-v-911c7d1f"]]),Me={class:"h-full flex"},He={key:0,class:"px-[50px]"},Je={class:"my-[60px] text-center text-[30px] font-medium"},We={class:"flex"},ze={class:"flex flex-col justify-center items-center mb-[20px]"},Ge=["src"],Oe={class:"text-[16px] font-medium mt-[16px]"},Qe=["onClick"],Xe=z({__name:"index",async setup(_){let e,s;const i=Y(),l=pe(),h=me(),p=_e(),f=U(null),{sessionActive:a,sessionAdd:u,currentSession:t,sessionEdit:g,getSessionLists:x}=([e,s]=R(()=>te()),e=await e,s(),e);[e,s]=R(()=>F(()=>x(),{default(){return[]},immediate:!0},"$pqtWcjQkdb")),await e,s();const{data:j}=([e,s]=R(()=>F(()=>Ie({type:1}),"$cmRBlMwAGX")),e=await e,s(),e),{data:o,refresh:$}=([e,s]=R(()=>F(()=>$e({type:1,category_id:a.value,page_type:0}),{transform(v){return v.lists.map(y=>y.type==1?{...y,from_avatar:i.userInfo.avatar}:{...y,from_avatar:l.config.chat.chat_logo})},default(){return[]}},"$P8rApiifAs")),e=await e,s(),e),k=U(!1),G=async(v,y)=>{if(!i.isLogin)return i.toggleShowLogin(!0);if(!k.value){a.value===0&&await u(),t.value==="新的会话"&&await g(a.value,v),o.value.push({type:1,content:v,from_avatar:i.userInfo.avatar}),o.value.push({type:2,loading:!0,content:[],from_avatar:l.config.chat.chat_logo,id:""}),k.value=!0;try{await Le({model:y,question:v,type:1,category_id:a.value},{onstart(L){V=L},onmessage(L){L.trim().split("data:").forEach(async A=>{if(A!=="")try{const E=JSON.parse(A),{id:w,code:b,event:B,data:D,index:T,incremental:ae}=E;B=="error"&&b===101&&l.getIsShowVip?(await ve.confirm("开通会员，享受更多权益，VIP期间会员免费通道对话不消耗条数","对话余额不足",{confirmButtonText:"前往开通",cancelButtonText:"取消",type:"warning"}),h.push("/openvip")):B=="error"&&P.msgError(D),console.log(E);let C=o.value.findIndex(oe=>oe.id===w);if(C===-1&&(C=o.value.length-1,o.value[C].id=w),D&&(o.value[C].content[T]||(o.value[C].content[T]=""),o.value[C].content[T]=ae?o.value[C].content[T]+D:D),B==="finish"){o.value[C].loading=!1;return}}catch{}})},onclose(){k.value=!1,setTimeout($,400)}}),f.value.cleanInput()}catch{k.value=!1,o.value.splice(o.value.length-2,2)}N(()=>{f.value.scrollToBottom()})}};let V=null;const O=v=>{V==null||V.cancel(),v&&(o.value[v].loading=!1),k.value=!1},se=async()=>{console.log(),await P.confirm("确定清空对话？"),await Se({type:1,category_id:a.value}),o.value=[]};return fe(async()=>{if(p.query.cid||p.query.user_sn){const v=X("cid"),y=X("user_sn");v.value=p.query.cid,y.value=p.query.user_sn,await N(),i.checkShare()}await N(),f.value.scrollToBottom()}),H(a,async()=>{O(),await $(),await N(),f.value.scrollToBottom()}),(v,y)=>{const L=Fe,A=Ee,E=be;return c(),d("div",null,[m(E,{name:"default"},{panel:I(()=>[m(L)]),default:I(()=>[r("div",Me,[m(A,{ref_key:"chattingRef",ref:f,"content-list":n(o),"send-disabled":n(k),avatar:n(l).config.chat.chat_logo,onClose:O,onUpdate:n($),onContentPost:G,onCleanChatLog:se},{default:I(()=>[n(o).length?J("",!0):(c(),d("div",He,[r("div",Je,q(n(l).getWebsiteConfig.shop_name),1),r("div",We,[(c(!0),d(S,null,W(n(j).slice(0,3),w=>(c(),d("div",{key:w.id,class:"flex-1 mx-[10px]"},[r("div",ze,[w.image?(c(),d("img",{key:0,class:"w-[58px] h-[58px]",src:w.image,alt:""},null,8,Ge)):J("",!0),r("div",Oe,q(w.name),1)]),r("div",null,[(c(!0),d(S,null,W(w.sample,b=>(c(),d("div",{key:b.id,class:"sample-item mb-[20px] p-[10px] flex justify-center cursor-pointer line-clamp-1",onClick:B=>G(b.content)},q(b.content),9,Qe))),128))])]))),128))])]))]),_:1},8,["content-list","send-disabled","avatar","onUpdate"])])]),_:1})])}}});const ht=ee(Xe,[["__scopeId","data-v-9402e02f"]]);export{ht as default};
