import{a as re,j as de,k as ue,l as pe,_ as fe}from"./model-picker.vue.156c1490.js";import{a as q,o as s,i as l,h as n,z as D,f as a,e as d,u as c,bU as ye,l as r,a8 as m,c as w,H as A,J as _e,ag as G,ah as O,a7 as me,a9 as ve,r as _,v as F,t as ge,F as U,j as K,k as he,a2 as J,a3 as xe,ad as V,a0 as Ce}from"./entry.47644ad8.js";import{_ as Q}from"./index.vue.758401c0.js";/* empty css                */import{E as ke}from"./index.2d38d06b.js";import{_ as W}from"./_plugin-vue_export-helper.c27b6911.js";import{u as be,a as we}from"./index.1d02bbbe.js";import{c as $e}from"./my.94b48df2.js";import{E as Se}from"./index.5f1ada03.js";const R=e=>(G("data-v-36f30656"),e=e(),O(),e),Be={class:"chat-message flex"},Ie={key:0,class:"ml-auto"},Ee={class:"message-contain message-contain--my"},Le=R(()=>n("span",{class:"text-xs ml-[4px]"},"复制",-1)),Ve={key:1,class:"message-contain message-contain--his flex flex-col"},De={key:0,class:"flex items-center text-tx-secondary text-sm mt-[8px]"},Re={class:"flex items-center",style:{animation:"loading-rotate 2s linear infinite"}},ze=R(()=>n("div",{class:"ml-[5px]"},"加载中，请稍等",-1)),Me=R(()=>n("div",{class:"text-[#FFA621]"},"停止回答",-1)),Te={key:1},Ne=q({__name:"index",props:{loading:{type:Boolean,default:!1},stopping:{type:Boolean,default:!1},avatar:{type:String,default:""},type:{type:Number,default:null},showCopyBtn:{type:Boolean,default:!0},showCollectBtn:{type:Boolean,default:!0},isCollet:{type:Number}},emits:["collect","close","copyContent","copyMyContent"],setup(e,{emit:y}){const f=()=>{y("collect")},u=()=>{y("copyMyContent")},$=()=>{y("copyContent")};return(h,v)=>{const x=_e,p=Q;return s(),l("div",Be,[e.type==1?(s(),l("div",Ie,[n("div",Ee,[D(h.$slots,"my",{},void 0,!0)]),n("div",{class:"flex items-center justify-end text-[#999999] pr-4 pt-2 cursor-pointer",onClick:u},[a(x,null,{default:d(()=>[a(c(ye))]),_:1}),Le])])):r("",!0),a(c(ke),{class:"message-avatar",size:40,src:e.avatar},null,8,["src"]),e.type==2?(s(),l("div",Ve,[n("div",null,[D(h.$slots,"rob",{},void 0,!0)]),e.loading?(s(),l("div",De,[n("div",Re,[a(p,{name:"el-icon-Loading",class:"circular"})]),ze,a(c(m),{type:"primary",link:"",disabled:!e.stopping,onClick:v[0]||(v[0]=S=>y("close"))},{default:d(()=>[Me]),_:1},8,["disabled"])])):r("",!0),e.loading?r("",!0):(s(),l("div",Te,[e.showCopyBtn?(s(),w(c(m),{key:0,class:"mt-2",type:"primary",link:"",onClick:$},{default:d(()=>[A(" 复制 ")]),_:1})):r("",!0),e.showCollectBtn?(s(),w(c(m),{key:1,class:"mt-2",type:e.isCollet?"primary":"info",link:"",onClick:f},{default:d(()=>[A(" 收藏 ")]),_:1},8,["type"])):r("",!0)]))])):r("",!0)])}}});const He=W(Ne,[["__scopeId","data-v-36f30656"]]),z=e=>(G("data-v-d9ced03a"),e=e(),O(),e),Pe={class:"chatting flex flex-col flex-1 bg-white py-[20px] w-full min-w-0 rounded-[20px]"},je={class:"flex-1 flex flex-col min-h-0"},Ae={key:0,class:"text-center"},Fe={key:0,class:"px-[40px] pb-[40px]"},Ue={class:"message-contain message--his"},Ke={key:0,class:"message-contain message--his"},Je={key:0,class:"text-primary"},qe={key:1,class:"message-contain message--my"},Ge={class:"flex justify-center pb-[10px]"},Oe=z(()=>n("span",{class:"ml-[5px]"},"继续",-1)),Qe={class:"lg:px-[50px] mx-[10px]"},We={class:"flex items-end"},Xe={class:"flex h-full items-end flex-1 rounded-sm overflow-hidden"},Ye=z(()=>n("span",{class:"text-white"},"发送",-1)),Ze=z(()=>n("span",{class:"text-primary"},"清空对话",-1)),et=q({__name:"chatting",props:{contentList:{type:Array,default:()=>[]},selectval:{type:String,default:""},chatType:{type:Number,default:0},title:{type:String,default:""},sendDisabled:{type:Boolean},avatar:{type:String}},emits:["loading","contentPost","cleanChatLog","update","close"],setup(e,{expose:y,emit:f}){const u=e,$=me(),h=ve(),{isLogin:v,toggleShowLogin:x}=h,p=_(""),S=_(null),C=_(null),k=_(""),X=o=>{le(o)},b=_({}),Y=async()=>{switch(u.chatType){case 2:b.value=await ue({id:u.selectval});break;case 3:b.value=await de({id:u.selectval})}};F(()=>u.selectval,o=>{console.log(o),u.chatType!=0&&Y()},{immediate:!1});const Z=()=>{v||x()},B=_(!1),ee=o=>{if(!(o.shiftKey&&o.keyCode===13)&&!B.value&&o.keyCode===13)return M(),o.preventDefault()},M=()=>{if(p.value.replace(/(^\s*)|(\s*$)/g,"")==""){V.msgError("输入为空！");return}u.sendDisabled||(v||x(),f("contentPost",p.value,k.value),Ce(()=>{I()}))},te=()=>{p.value=""},oe=()=>{f("cleanChatLog")},se=async(o,i)=>{i?await $e({collect_id:i}):await pe({records_id:o}),f("update")},{copy:ne}=be(),T=async o=>{try{await ne(o),V.msgSuccess("复制成功")}catch{V.msgSuccess("复制失败")}},ae=()=>C.value.wrapRef.scrollHeight-C.value.wrapRef.clientHeight,le=({scrollTop:o})=>{o==0&&console.log("刷新！")},I=()=>{const o=ae();C.value.setScrollTop(o)},{height:ce}=we(S);return F(ce,o=>{u.sendDisabled&&I()}),y({scrollToBottom:I,cleanInput:te}),(o,i)=>{const E=fe,L=He,ie=Q;return s(),l("div",Pe,[n("div",je,[e.title?(s(),l("div",Ae,ge(e.title),1)):r("",!0),a(c(Se),{ref_key:"scrollbarRef",ref:C,height:"100%",onScroll:X},{default:d(()=>[D(o.$slots,"default",{},void 0,!0),n("div",{ref_key:"innerRef",ref:S},[!e.contentList.length&&c(b).tips?(s(),l("div",Fe,[n("div",Ue,[e.chatType!=0?(s(),w(L,{key:0,type:2,"is-collet":0,avatar:e.avatar,"show-collect-btn":!1,"show-copy-btn":!1},{rob:d(()=>[a(E,{content:c(b).tips},null,8,["content"])]),_:1},8,["avatar"])):r("",!0)])])):r("",!0),(s(!0),l(U,null,K(e.contentList,(t,N)=>(s(),l("div",{key:N,class:"px-[40px] pb-[40px]"},[t.type===2?(s(),l("div",Ke,[a(L,{avatar:t.from_avatar,type:2,loading:t.loading,stopping:!!t.content,"is-collet":t.is_collect,onCollect:g=>se(t.id,t.is_collect),onCopyContent:g=>T(t.content),onClose:g=>f("close",N)},{rob:d(()=>[t.loading&&!t.content.length?(s(),l("div",Je," 等待回复中... ")):r("",!0),(s(!0),l(U,null,K(t.content,(g,H)=>{var P,j;return s(),l("div",{key:H,class:he(["mb-[15px]",{" pt-[15px] border-t border-solid border-br-light":H>0}])},[a(E,{loading:t.loading,content:g,"use-markdown":!!((j=(P=c($).config)==null?void 0:P.chat)!=null&&j.is_markdown)},null,8,["loading","content","use-markdown"])],2)}),128))]),_:2},1032,["avatar","loading","stopping","is-collet","onCollect","onCopyContent","onClose"])])):r("",!0),t.type===1?(s(),l("div",qe,[a(L,{avatar:t.from_avatar,type:1,onCopyMyContent:g=>T(t.content)},{my:d(()=>[a(E,{content:t.content},null,8,["content"])]),_:2},1032,["avatar","onCopyMyContent"])])):r("",!0)]))),128))],512),n("div",Ge,[e.contentList.length?(s(),w(c(m),{key:0,disabled:e.sendDisabled,color:"#f6f6f6",round:!0,style:{"--el-button-disabled-text-color":"#999"},onClick:i[0]||(i[0]=t=>f("contentPost","继续"))},{default:d(()=>[a(ie,{name:"el-icon-VideoPlay",size:18}),Oe]),_:1},8,["disabled"])):r("",!0)])]),_:3},512)]),n("div",Qe,[a(re,{modelValue:c(k),"onUpdate:modelValue":i[1]||(i[1]=t=>J(k)?k.value=t:null)},null,8,["modelValue"]),n("div",We,[n("div",Xe,[a(c(xe),{modelValue:c(p),"onUpdate:modelValue":i[2]||(i[2]=t=>J(p)?p.value=t:null),"input-style":{backgroundColor:"var(--el-bg-color-page)"},class:"min-h-full py-[4px]",placeholder:"请输入内容（Shift + Enter）= 换行",type:"textarea",autosize:{maxRows:4},resize:"none",onCompositionstart:i[3]||(i[3]=t=>B.value=!0),onCompositionend:i[4]||(i[4]=t=>B.value=!1),onKeydown:ee,onClick:Z},null,8,["modelValue","input-style"])]),a(c(m),{class:"ml-2",type:"primary",onClick:M,size:"large",disabled:e.sendDisabled},{default:d(()=>[Ye]),_:1},8,["disabled"]),a(c(m),{type:"primary",link:"",class:"ml-4",onClick:oe},{default:d(()=>[Ze]),_:1})])])])}}});const dt=W(et,[["__scopeId","data-v-d9ced03a"]]);export{dt as _};
