import{d as e,x as t,C as a,D as s,W as l,r as o,B as i,M as n,G as r,o as p,i as c,g as u,f as m,u as d,e as f,h as v,t as _,j as y,F as g,l as h,J as j,a as b,b as k,K as x,k as w,ab as C,L as I,_ as T}from"./index-5fd89c82.js";import{_ as V}from"./page-meta.e1766212.js";import{_ as L}from"./u-icon.a1449c4b.js";import{_ as R}from"./u-sticky.5e84e153.js";import{i as F,_ as N,a as P,b as S}from"./icon_member.69f665f0.js";import{g as U,e as $,f as B,c as D}from"./chat.b5adffe9.js";import{u as G}from"./useLockFn.b0443122.js";import"./u-loading.e1adf064.js";import"./useCopy.dbed25b8.js";import"./text-item.vue_vue_type_script_setup_true_lang.eddf7716.js";import"./_commonjsHelpers.8b4586d6.js";import"./u-button.ea6057e5.js";import"./u-input.89121eb6.js";import"./emitter.1571a5d9.js";import"./u-picker.81fd0f22.js";import"./u-popup.f70e8582.js";import"./index.3e35f6de.js";import"./l-painter.bfe68192.js";const H=T(e({__name:"chat",setup(e){const T=j(),H=t(),K=a(),{userInfo:M}=s(K),W=l({id:0,type:1,token:""}),z=o([]),E=i(),J=async()=>{const e=await U({other_id:W.id,type:W.type,page_type:0});z.value=e.lists,setTimeout((()=>{var e;null==(e=E.value)||e.scrollToBottom()}),200)};let X=null;const Z=e=>{X=e},q=e=>{null==X||X.cancel(),e&&(z.value[e].loading=!1)},A=o({}),O=async()=>{(async()=>{switch(W.type){case 2:A.value=await B({id:W.id});break;case 3:A.value=await $({id:W.id})}C({title:A.value.name})})(),J()},{lockFn:Q}=G((async()=>{if(!K.isLogin)return te();(await I({title:"温馨提示",content:"确定清空对话？"})).cancel||(await D({type:W.type,other_id:W.id}),J())})),Y=i(),ee=async e=>{const t=z.value.filter((t=>t.id==e));2==t.length?Y.value.initPosterData({title:t[0].content,content:t[1].content}):uni.$u.toast("上下文数据不对～")},te=()=>T.navigateTo({path:"/pages/login/login"}),ae=()=>{T.navigateTo({path:"/packages/pages/open_vip/open_vip"})};return n((e=>{W.id=Number(null==e?void 0:e.id),W.type=Number(null==e?void 0:e.type),O()})),r((()=>{q()})),(e,t)=>{const a=b(k("page-meta"),V),s=b(k("u-icon"),L),l=x,o=w,i=b(k("u-sticky"),R),n=b(k("chat-record-item"),N),r=b(k("chat-scroll-view"),P),j=b(k("dialog-poster"),S);return p(),c(g,null,[u(a,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),u(o,{class:"safe-area-inset-bottom h-screen bg-white"},{default:m((()=>[u(r,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=e=>z.value=e),ref_key:"chatRef",ref:E,tips:A.value.tips,type:W.type,otherId:W.id,onEnd:J,onReader:Z},{default:m((()=>[u(o,{class:"bg-white scroll-view-content"},{default:m((()=>[u(i,{"h5-nav-height":"0"},{default:m((()=>[u(o,{class:"px-[30rpx] py-[26rpx] text-sm flex justify-between bg-white"},{default:m((()=>[d(H).getIsShowVip?(p(),f(o,{key:0,class:"flex-1"},{default:m((()=>[u(o,{onClick:ae,class:"flex items-center"},{default:m((()=>[u(s,{size:34,name:d(F)},null,8,["name"]),u(l,{class:"ml-[10rpx]"},{default:m((()=>[v(_(d(M).is_member?"已开通会员，对话不消耗条数":"开通会员"),1)])),_:1})])),_:1})])),_:1})):y("v-if",!0),u(l,{class:"text-muted ml-auto",onClick:d(Q)},{default:m((()=>[v(" 清空对话 ")])),_:1},8,["onClick"])])),_:1})])),_:1}),u(o,{class:"chat-record pt-[20rpx]"},{default:m((()=>[!z.value.length&&A.value.tips?(p(),f(n,{key:0,type:"left",avatar:A.value.image,content:`${A.value.tips}`,"show-collect-btn":!1},null,8,["avatar","content"])):y("v-if",!0),(p(!0),c(g,null,h(z.value,((e,t)=>(p(),f(n,{key:t,"record-id":e.id,type:1==e.type?"right":"left",content:e.content,loading:e.loading,avatar:A.value.image,"is-collect":e.is_collect,onUpdate:J,onClose:e=>q(t),onClickPoster:ee},null,8,["record-id","type","content","loading","avatar","is-collect","onClose"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","tips","type","otherId"]),y("  生产对话海报  "),u(j,{ref_key:"posterRef",ref:Y},null,512)])),_:1})],64)}}}),[["__scopeId","data-v-bb1b48f0"]]);export{H as default};
