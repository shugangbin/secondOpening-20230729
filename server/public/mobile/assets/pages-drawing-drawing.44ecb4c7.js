import{R as e,_ as t,r as a,w as l,o as r,e as s,f as o,g as n,n as i,y as c,h as u,t as d,j as A,T as m,U as p,K as g,k as f,d as x,V as w,i as h,F as _,l as C,a as v,b as y,A as B,S as Q,z as b,C as R,x as k,B as F,c as I,W as E,u as D,s as V,J as U,X as K,Y as S,Z as Y,$ as G,Q as N,a0 as z,a1 as j,L as H,a2 as T,a3 as P,M as L,a4 as M,a5 as Z}from"./index-5fd89c82.js";import{_ as J}from"./page-meta.e1766212.js";import{_ as O}from"./u-empty.c5bbad9c.js";import{_ as W}from"./u-tabs.cf633c5c.js";import{_ as X}from"./tabbar.vue_vue_type_script_setup_true_lang.f97ce269.js";import{_ as q}from"./u-loading.e1adf064.js";import{_ as $}from"./u-icon.a1449c4b.js";import{u as ee}from"./useLockFn.b0443122.js";import{_ as te}from"./u-popup.f70e8582.js";import{_ as ae}from"./u-picker.81fd0f22.js";import{_ as le}from"./u-image.adbe7f0a.js";import{s as re}from"./file.1f2c71c1.js";import{u as se}from"./useCopy.dbed25b8.js";import"./u-badge.c3ab894f.js";const oe=t({__name:"l-textarea",props:{placeholder:"",maxlength:"",showWordLimit:!1,customClass:{},error:"",rows:"",modelValue:""},emits:["update:modelValue"],setup(e,{emit:t}){var x;const w=e,h=a(w.modelValue),_=a((null==(x=w.modelValue)?void 0:x.length)||0),C=a(!1),v=e=>{const a=e||window.event,l=a.detail||a.taget;t("update:modelValue",l.value)};return l((()=>w.modelValue),(e=>{h.value=e,_.value=e.length})),(t,a)=>{const l=p,x=g,w=f;return r(),s(w,{class:i(["l-textarea",{error:e.error}]),"data-error":e.error},{default:o((()=>[n(l,{class:i(["l-textarea__inner",{"!border-primary":C.value}]),"placeholder-class":"l-textarea__placeholder",placeholder:e.placeholder,rows:e.rows,modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value=e),maxlength:e.maxlength,style:c(e.customClass),onInput:v,onFocus:a[1]||(a[1]=e=>C.value=!0),onBlur:a[2]||(a[2]=e=>C.value=!1)},null,8,["placeholder","rows","modelValue","maxlength","class","style"]),e.showWordLimit?(r(),s(w,{key:0,class:"l-textarea-length-maxlength"},{default:o((()=>[n(x,null,{default:o((()=>[u(d(_.value),1)])),_:1}),u(" / "),n(x,null,{default:o((()=>[u(d(e.maxlength),1)])),_:1})])),_:1})):A("v-if",!0),m(t.$slots,"length-suffix",{},void 0,!0)])),_:3},8,["data-error","class"])}}},[["__scopeId","data-v-039276b6"]]),ne="/mobile/assets/empty-fde1f8b1.png",ie=t(x({__name:"keyword-suggestion",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(t,{expose:l,emit:c}){const m=t,p=a(!1),g=a(0),x=a([]),R=a({prompt:[],cate_prompt:[]}),k=a([]);w((()=>{""==m.modelValue&&(k.value=[])}));const F=e=>{const t=k.value.findIndex((t=>t==e));t>=0?k.value.splice(t,1):k.value.push(e)},I=e=>{g.value=e,D()},E=async()=>{try{x.value=await e.get({url:"/draw_prompt/category"}),await D()}catch(t){console.log("获取关键词分类错误",t)}},D=async()=>{try{R.value=await(t={id:x.value[g.value].id},e.get({url:"/draw_prompt/prompt",data:t}))}catch(a){console.log("获取关键词错误",a)}var t};return l({open:()=>{p.value=!0,E()}}),(e,t)=>{const a=f,l=v(y("u-tabs"),W),w=B,E=Q,D=b,V=v(y("u-popup"),te);return r(),s(V,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),mode:"center",closeable:!0,"border-radius":"20"},{default:o((()=>[n(a,{class:"w-[640rpx] h-[980rpx]"},{default:o((()=>[n(a,{class:"p-[30rpx] text-lg text-main text-center"},{default:o((()=>[u("关键词推荐")])),_:1}),x.value.length?(r(),s(l,{key:0,list:x.value,"is-scroll":!0,"active-color":e.$theme.primaryColor,height:"60rpx","font-size":"28rpx",current:g.value,onChange:I},null,8,["list","active-color","current"])):A("v-if",!0),n(E,{class:"h-[700rpx]","scroll-y":!0},{default:o((()=>[R.value.prompt.length||R.value.cate_prompt.length?(r(),h(_,{key:0},[(r(!0),h(_,null,C(R.value.cate_prompt,((e,t)=>(r(),s(a,{key:t,class:"keyword-container"},{default:o((()=>[n(a,{class:"keyword-title text-base text-[#666]"},{default:o((()=>[u(d(e.name)+"("+d(null==e?void 0:e.prompt.length)+") ",1)])),_:2},1024),(r(!0),h(_,null,C(e.prompt,(e=>(r(),s(a,{key:e.text,class:i(["keyword-item",{"keyword-item-active":k.value.includes(e.prompt_en)}]),onClick:t=>F(e.prompt_en)},{default:o((()=>[u(d(e.prompt_en)+" ｜ "+d(e.prompt),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)))),128)),R.value.prompt.length?(r(),s(a,{key:0,class:"keyword-container"},{default:o((()=>[R.value.cate_prompt.length?(r(),s(a,{key:0,class:"keyword-title text-base text-[#666]"},{default:o((()=>[u(" 其它("+d(R.value.prompt.length)+") ",1)])),_:1})):A("v-if",!0),(r(!0),h(_,null,C(R.value.prompt,(e=>(r(),s(a,{key:e.text,class:i(["keyword-item",{"keyword-item-active":k.value.includes(e.prompt_en)}]),onClick:t=>F(e.prompt_en)},{default:o((()=>[u(d(e.prompt_en)+" ｜ "+d(e.prompt),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})):A("v-if",!0)],64)):(r(),s(a,{key:1,class:"h-full flex flex-col justify-center items-center"},{default:o((()=>[n(w,{class:"w-[300rpx] h-[300rpx]",src:ne}),n(a,{class:"text-muted text-center"},{default:o((()=>[u("暂无关键词推荐")])),_:1})])),_:1}))])),_:1}),n(a,{class:"flex mt-[20rpx] px-[30rpx]"},{default:o((()=>[n(D,{class:"footer_btn full_btn",onClick:t[0]||(t[0]=e=>(()=>{p.value=!1;const e=m.modelValue+k.value.join(",")+",";c("update:modelValue",e),k.value=[]})())},{default:o((()=>[u(" 添加到文本描述 ")])),_:1}),n(D,{class:"footer_btn plain_btn ml-[20rpx]",onClick:t[1]||(t[1]=e=>(p.value=!1,c("update:modelValue",k.value.join(",")+","),void(k.value=[])))},{default:o((()=>[u(" 替换当前文本 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-c87bd72c"]]),ce=t(x({__name:"index",props:{modelValue:{default:{prompt:"",action:"",image_base:"",image_id:"",scale:""}},isReceiving:{type:Boolean,default:!1}},emits:["drawing","update:modelValue"],setup(t,{emit:p}){const x=t;U(),R();const w=k(),z=F(),j=I({get:()=>x.modelValue,set:e=>{p("update:modelValue",e)}}),H=a([]),T=E({current:0,lists:[{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAOFJREFUeF7t3LENgzAARcF4A+8/pTcgdYiCFT2lCUcPxeP86RhzzuPh+lhgCHStQ6DN6RHo20BrrXHnSTpPzpsggV4/WgKdjgtBm/0QSKD2iSGIIIJaAYJaPxtEEEGtAEGtnw0iiKBWgKDWzwYRRFArQFDrZ4MIIqgVIKj1s0EEEdQKENT62SCCCGoFCGr9bBBBBLUCBLV+NogggloBglo/G0QQQa0AQa2fDSKIoFaAoNbPBhFEUCtAUOtngwgiqBUgqPWzQQQR1AoQ1PrZIIJ+LKg9/v/u9geqzTsVSKB27J+TPVWQBC9q5AAAAABJRU5ErkJggg==",name:"头像图",widthRatio:1,heightRatio:1},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAQdJREFUeF7t3EFuwjAARUFyg9z/lLkBCJaRUIyejUCarlsDL+OvdtPtNulr3/f7pKOmHHMcxzbjoCmHPN+IQBePQyCB2o09C5q1AaPvatXrL9sggU6PdtUTJGi0wIcbOEuwK3YRXiCB2h0miCCCXgVW/ZrhirlirpgrNmLABvlTY8TJ++8hiCCCWgGCWj8bRBBBrQBBrZ8NIoigVoCg1s8GEURQK0BQ62eDCCKoFSCo9bNBBBHUChDU+tkggghqBQhq/WwQQQS1AgS1fjaIIIJaAYJaPxtEEEGtAEGtnw0iiKBWgKDWzwYRRFArQFDr93cb1D5u/+mf/+cm/SO2EwS66CfQlwI9AAMdIGdcS1eyAAAAAElFTkSuQmCC",name:"手机壁纸",widthRatio:1,heightRatio:2},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAQ9JREFUeF7t28sNgzAQBuHQAf1X6Q4S5QZE8mr1++BIH1cegtHsgA8cr2I7z/NdHfPP+8cYx+z+pzu/JwLEIAbNHFg+YtUFd+/RMxnV87QbVF0QoKL6AAF0d6A7swxiEIOuBLzFVi81vOYflRXp5lqMQQy6ERBpkc4+WxjEIAa1ln/dzxYjZsSMmBFrEVi8MtAgDdKg1gR6zWtQS5ifgxnEIAZlBBiU8dMgBjEoI8CgjJ8GMYhBGQEGZfw0iEEMyggwKOOnQQxiUEaAQRk/DWIQgzICDMr4aRCDGJQRYFDGT4MYxKCMAIMyfhrEIAZlBBiU8dMgBm1uUHZ7+51d/cXd/ldjv0fM7giggh9AIaAP+HAgZ5ZlFy4AAAAASUVORK5CYII=",name:"文案图",widthRatio:3,heightRatio:4},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAPBJREFUeF7t28ENglAURUHogP6rpAPdQ8IjOWFBGNcKyXH+1Q3r4nVZYNXnuoBAgxCBBGojQhBBBLUCk6Bt236P3uHlF18FGv4HCSRQOuSnI7bv+6d/+o8nSqCDL4GGAyeQQGmTF4IIIqgVIKj1s0EEEdQKENT62SCCCGoFCGr9bBBBBLUCBLV+NogggloBglo/G0QQQa0AQa2fDSKIoFaAoNbPBhFEUCtAUOtngwgiqBUgqPWzQQQR1AoQ1PrZIIIIagWqoEfv/sKLe2Z1+NIEEqid608/n3onnUDTEbtT8cvvIYig5p8ggghqBYZP/wEv5wKgWzTnpQAAAABJRU5ErkJggg==",name:"社交媒体",widthRatio:4,heightRatio:3},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAP1JREFUeF7t3EEOgkAQAEH5Af9/JT/QeIQLmTTZaFKeF12b2sGT22v42vf9Pbzkp5Yfx7FNNjRa/H1jgW7yCiTQqUA+YtMzPTn/T6y9ip/uV6CbuyCQQOefJY7YRYQZNHzqEkTQ7OHviDliMzHX1QQRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYR9OeC2vbXX738rynWf8X2iQLd9BPo4UAfyX8gZ6mQMfoAAAAASUVORK5CYII=",name:"宣传海报",widthRatio:9,heightRatio:16},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAOFJREFUeF7t3LENgzAARcF4A+8/pTcgdYiCFT2lCUcPxeP86RhzzuPh+lhgCHStQ6DN6RHo20BrrXHnSTpPzpsggV4/WgKdjgtBm/0QSKD2iSGIIIJaAYJaPxtEEEGtAEGtnw0iiKBWgKDWzwYRRFArQFDrZ4MIIqgVIKj1s0EEEdQKENT62SCCCGoFCGr9bBBBBLUCBLV+NogggloBglo/G0QQQa0AQa2fDSKIoFaAoNbPBhFEUCtAUOtngwgiqBUgqPWzQQQR1AoQ1PrZIIJ+LKg9/v/u9geqzTsVSKB27J+TPVWQBC9q5AAAAABJRU5ErkJggg==",name:"自定义",widthRatio:"",heightRatio:""}]}),P=I((()=>{const e=T.lists[T.current];if(e){const{widthRatio:t,heightRatio:a}=e;if(t&&a)return`${t}:${a}`}return""}));l((()=>T),(e=>{e.current>=0&&(j.value.scale=P.value)}),{immediate:!0,deep:!0});const{isLock:L,lockFn:M}=ee((async()=>{try{if(""==j.value.prompt.trim())return void uni.$u.toast("请输入描述词");const{translate:a}=await(t={prompt:j.value.prompt},e.get({url:"/draw_prompt/translate",data:t}));j.value.prompt=a}catch(a){console.log("翻译失败=>",a)}var t})),Z=async()=>{try{H.value=await e.get({url:"/draw_prompt/example"})}catch(t){console.log("请求绘画示例失败=>",t)}};Z();const J=()=>{K({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{O(e.tempFilePaths[0])}})},O=async e=>{S({title:"上传中"});try{const t=await Y(e);j.value.image_base=t.uri,G()}catch(t){G(),uni.$u.toast(t),console.log("上传图片失败",t)}},W=()=>{j.value.action="generate",console.log(j.value),p("drawing",{drawing:j.value,isClear:!0})};return(e,a)=>{const l=g,p=f,x=v(y("u-loading"),q),R=B,k=v(y("u-icon"),$),F=v(y("l-textarea"),oe),I=N,E=Q,U=b;return r(),s(p,{class:"h-full flex flex-col"},{default:o((()=>[n(p,{class:"flex-1 min-h-0"},{default:o((()=>[n(E,{class:"h-full","scroll-y":!0},{default:o((()=>[n(p,{class:"h-full p-[30rpx] relative"},{default:o((()=>[A("    描述推荐    "),n(p,{class:"flex justify-between"},{default:o((()=>[n(p,{class:"text-base"},{default:o((()=>[n(l,{class:"font-medium"},{default:o((()=>[u(" 文本描述 ")])),_:1}),n(l,{class:"text-error"},{default:o((()=>[u("*")])),_:1})])),_:1})])),_:1}),A("    关键词输入    "),n(p,{class:"mt-[24rpx]"},{default:o((()=>[n(F,{modelValue:D(j).prompt,"onUpdate:modelValue":a[2]||(a[2]=e=>D(j).prompt=e),maxlength:"1024",rows:5,"show-word-limit":!1,"custom-class":{paddingBottom:"60rpx"},placeholder:"输入英文描述词，生成效果会更好；描述词越详细，生成的图片效果更加真实哦～~"},{"length-suffix":o((()=>[n(p,{class:"length-suffix justify-end text-sm"},{default:o((()=>{var t,i;return[n(p,{class:"text-primary",onClick:a[0]||(a[0]=e=>{var t;return null==(t=D(z))?void 0:t.open()})},{default:o((()=>[u(" 描述词推荐 ")])),_:1}),2==(null==(i=null==(t=D(w))?void 0:t.getDrawConfig)?void 0:i.translate_type)?(r(),s(p,{key:0,class:"ml-[40rpx] text-muted hover:text-primary",loading:D(L),onClick:V(D(M),["stop"])},{default:o((()=>[D(L)?(r(),s(x,{key:0,mode:"flower",color:e.$theme.primaryColor,size:"28"},null,8,["color"])):(r(),s(R,{key:1,class:"w-[26rpx] h-[26rpx]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAxJJREFUaEPtmD9oFEEUxt83F0kfECSC2AiChQgWFhaKWCiKBGLEwj/HuTNZE0Q74wlpNIoICjHZmbsT/IMoESFoQAtRa0UQFEQQNKVYKNgZdkYWspI7d5ObzWTPg9vyZt77vt97e7O7D9TmF9rcP3UAWt3BTgdsOlCr1XrCMCwC+MQ5n7GJTdubWweCIFjPGPsSGzHGTIVhWB4aGvq8HJDcAKSUHIBqMDsLoMw5v5cVIjeAyKBSyiQZBTBeKBTKpVLply1IrgBSyq0A3qRAvCaiqBvPbSByBYiNKaXuENGRFKPnhRAXm4VoCUBkTkq5C0BitY0xMwDOCSHeLwXSMoDYmJRyGsCBBKPftdZl3/eri0G0HGC+G0cB3E75b9yMTirP874lri/VorzWgyBYyxi7S0Q7EzQ/zB+3jxvX/osOLDQlpRwBMJZSuDEhRHnhWh2AlHICwEEiWp1X5TPoPBRCDMRxfwGCINjBGHuZIWHuIQD2cs6fRsJtCaC1Lvq+f6sOYP40aIdbqKK1vuT7/td/AHK/FxwI/nenkC1TB8C2Yq73dzrguqK2+TodsK2Y6/11HQiC4DhjbD+AHtdCrvJpre93d3dPFYvFn42vEnVjD1eCK5SnTwgxXQdQqVT2GWOerJCg67RnhBDXk96FagBKrtVc5jPGvGWMneCcv0sC2MAYmzDG7E4RPam1/ujSkG0u3/dfLYxJPEaVUtFXz4WU5M+6uroGsgyhbM02sz/1OaCU2k5EN4hoc1Iixtgxz/Oi+U5Lr0UfZEqpVUR0lYhOpbh8JITobyVBU0/iarXaH4bhOIA1jWYB/Aawx/O8F60AaQogMqaUWkdEV4joUJJRY0x1cHCQ5w3RNEBsTCkV3U7XiIglmP0xNze3ZXh4eDYvEGuAyNjk5OS2QqEQzW6ShlAkhMiUNwt0ZqHR0VHW29sbTZHPJgiPCCEuZzFkG5MZIBaqVCp9xpioGxvj3wAc5pw/sDWTZf+yASLRaK4J4DSATVrrqXhmk8WQbYwTAFtRl/s7AC6rmSVXpwNZquYy5g8z9Ncxp/yLngAAAABJRU5ErkJggg=="})),n(l,{class:"ml-[10rpx]"},{default:o((()=>[u("翻译成英文")])),_:1})])),_:1},8,["loading","onClick"])):A("v-if",!0),n(p,{class:"cursor-pointer text-muted hover:text-primary ml-[40rpx]",onClick:a[1]||(a[1]=V((e=>D(j).prompt=""),["stop"]))},{default:o((()=>[n(k,{name:"trash"}),n(l,null,{default:o((()=>[u("清空")])),_:1})])),_:1})]})),_:1})])),_:1},8,["modelValue"])])),_:1}),A("    关键词示例    "),n(p,{class:"flex justify-between mt-[20rpx] text-base"},{default:o((()=>[n(p,{class:"flex items-center cursor-pointer text-muted",onClick:Z},{default:o((()=>[n(p,{class:"flex items-center text-[#8e8e8e] hover:text-primary"},{default:o((()=>[n(k,{name:"reload"}),n(l,{class:"text-muted ml-[10rpx]"},{default:o((()=>[u("随便试试")])),_:1})])),_:1}),n(p,{class:"ml-[10rpx] text-black truncate w-[500rpx]"},{default:o((()=>[(r(!0),h(_,null,C(H.value,((e,t)=>(r(),s(l,{class:"ml-[20rpx]",key:t,onClick:V((t=>{return a=e.prompt_en,void(j.value.prompt=a);var a}),["stop"])},{default:o((()=>[u(d(e.prompt),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),n(p,{class:"cursor-pointer flex items-center"},{default:o((()=>[A('                    <el-icon size="18"><RefreshRight /></el-icon>')])),_:1})])),_:1}),A("    上传参考图    "),n(p,{class:"mt-[40rpx]"},{default:o((()=>[n(p,{class:"text-base font-medium"},{default:o((()=>[u("上传参考图")])),_:1}),n(p,{class:"uploader mt-[20rpx] flex justify-center items-center",onClick:J},{default:o((()=>[A("    没有图片的时候    "),D(j).image_base?(r(),h(_,{key:1},[A("    有图片的时候    "),n(p,{class:"w-full h-full relative text-center has_image",onClick:a[4]||(a[4]=V((()=>{}),["stop"]))},{default:o((()=>[n(k,{class:"has_img_delete",name:"close-circle-fill",color:"#ffffff",size:"40",onClick:a[3]||(a[3]=V((e=>D(j).image_base=""),["stop"]))}),n(R,{class:"w-full h-full",src:D(j).image_base,mode:"aspectFit"},null,8,["src"]),n(p,{class:"has_img_btn",onClick:J},{default:o((()=>[u("换图")])),_:1})])),_:1})],2112)):(r(),s(p,{key:0,class:"flex flex-col justify-center items-center"},{default:o((()=>[n(R,{class:"w-[72rpx] h-[72rpx] mb-[12rpx]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAABW5JREFUeF7tnE+IHEUUxt+DBkkOexNFc/IiKIg5CQpecpMQL9lAUCTxGhiYmp3DnpxcAz3N7iG3+Achh4QInjx48eAhAUFzSAjBm2iIFyULIQs7XaFhFtch213TO/X6db1vr1PV773v+9Xr6pnaZsKfaQXYdPUongCAcQgAAAAwroDx8tEBAIBxBYyXjw4AAIwrYLx8dAAAYFwB4+WjAwAA4woYLx8dAAAYV8B4+egAAMC4AsbLRwcAAMYVMF4+OgAAMK6A8fLRAQCAcQWMl48OAACMK2C8fHQAAGBcAePlowMAAOMKGC8fHQAAGFfAePnoAADAngLb29tv7e3tTYhonYjuMfOPRHR5OBz+a00Ncx1gbv4NInp7wezfsiz7ZDAY3LcEgSkAaszf9/xelmXnLEFgBoAA801CYAKAJcw3B0HyALQw3xQESQNwBPPNQJAsACsw3wQESQKwQvOThyA5ACKYnzQESQEQ0fxkIUgGAAHzk4QgCQAEzU8Ogt4DMJlMjq+trf1MRCcDvsPfJaKXGsaFjKkucTfLsvcGg0E1vrd/vQcgz/MJM38R4MATZr7ovb9VN9Z7f5aZvySitYBrXnXOXQoYp3ZICgBcZ+bzDQr/zcwXhsPhD9Pp1NeNdc5xnuen5xC83HDdZ865Y2rdDUis9wAURfGV9/5CTa1/zGazz8bj8U/VmBAAqnFbW1unyrL82nt/oubaD51zbwborHZICgB87r2/dojCv89ms0/H4/Gd/c9DAajG53n+PjN/S0RvHHL9W865s2rdDUis9wDMjXrRPuBX7/3F0Wh096AOywBQzSuK4l0i+sZ7/86Cnrd3d3c/2tzc/CdAZ7VDkgBgDsE6M6977/eI6OHOzs6VyWTydFH5ZQGY3zZeJ6JtIvqAiB4R0c2yLL/b2Nh4oNbZwMSSASCw3uA9QOj1+j4OACw4WD0F9N3UZfI3VewyTwHLiNjnsQAAHUCG3+l0Wh3F/pCIXqmLyMx/lWX5y2g0+jhGZm02gavIQ0v9i7WIdIAm0Q8TOMb9uCmXLmJK1i8OQJ7n3zPzmZar6KZz7lzLuS+cJg2AtvrFASiK4k/v/WstTXzsnHu15VwVAGirXxyAphXXYK51ACjGLemg5tH3AEcEwPotwDYAMehvArKLmHVdMEY+qjuA9cfARRiSByB2gYuCdtEB6lZ41/l0vgcAAM0nlFb5FKTuKQAAAIDoXegg9V23XG23pOjiQ/D6Bt61PgCg418DAYDwAYyuBcctwPiKAwAA4H8KdN2RsAcwDiQAAAAxv2cK/1esuFn8d/WuWy72AB2vuIYDGis/f9AEdtdAmrsFNBzRWvn5AwAQ8O/YTSKt+vPDVp307xJVXegAwl8E7cO0f0ybmWcxj6E3wQsAOgKgyRipzwEAAGh8Y0lMGM1tAmOK2eba6ADoAOgAbVZOKnPQAdAB0AFSWc1t6kAHQAew3QHarBpLc2J/O9n5Y6AlM9vUCgDaqJbQHACQkJltSuk9AEd8QUIbzVKaE/18QvQ9wBFfkZKSmW1qiX4+IToAIb95t1HGwpzY7b/SUASAOQRBr4mzYGxdjbHfj7AYWwwA68ZqrR8AaHVGKC8AICS01jAAQKszQnkBACGhtYYBAFqdEcoLAAgJrTUMANDqjFBeAEBIaK1hAIBWZ4TyAgBCQmsNAwC0OiOUFwAQElprGACg1RmhvACAkNBawwAArc4I5QUAhITWGgYAaHVGKC8AICS01jAAQKszQnkBACGhtYYBAFqdEcoLAAgJrTUMANDqjFBeAEBIaK1hAIBWZ4TyAgBCQmsNAwC0OiOUFwAQElprGACg1RmhvACAkNBawwAArc4I5fUcaJDBn3f6FnEAAAAASUVORK5CYII="}),n(p,{class:"text-muted"},{default:o((()=>[u("点击上传参考图")])),_:1})])),_:1}))])),_:1})])),_:1}),A("    图片尺寸    "),n(p,{class:"mt-[40rpx] pb-[20px]"},{default:o((()=>[n(p,{class:"text-base font-medium"},{default:o((()=>[u("图片尺寸")])),_:1}),n(p,{class:"flex justify-between flex-wrap"},{default:o((()=>[(r(!0),h(_,null,C(T.lists,((e,t)=>(r(),s(p,{key:t,class:i(["picture-size mt-[20rpx] rounded-[8rpx] text-center",{"picture-size-active":T.current==t}]),onClick:e=>T.current=t},{default:o((()=>[n(p,{class:"flex justify-center mt-[30rpx]"},{default:o((()=>[n(R,{class:"w-[36rpx] h-[36rpx]",src:e.icon},null,8,["src"])])),_:2},1024),5!=t?(r(),s(p,{key:0,class:"text-xl mt-[8rpx]"},{default:o((()=>[u(d(e.widthRatio)+":"+d(e.heightRatio),1)])),_:2},1024)):(r(),s(p,{key:1,class:"flex justify-center text-xl mt-[10rpx]"},{default:o((()=>[n(I,{modelValue:e.widthRatio,"onUpdate:modelValue":t=>e.widthRatio=t,class:"input-ratio w-7 text-center",type:"number",min:"0",max:"50"},null,8,["modelValue","onUpdate:modelValue"]),n(l,{class:"mx-[6rpx]"},{default:o((()=>[u(" : ")])),_:1}),n(I,{modelValue:e.heightRatio,"onUpdate:modelValue":t=>e.heightRatio=t,class:"input-ratio w-7 text-center",type:"number",min:"0",max:"50"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)),n(p,{class:"text-base mt-[4px]"},{default:o((()=>[u(d(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),n(p,{class:"bg-white z-10 w-full p-[20rpx]"},{default:o((()=>[A("    选择模型    "),m(e.$slots,"model",{},void 0,!0),A("    生成    "),n(U,{style:c({height:"82rpx",lineHeight:"82rpx",fontSize:"30rpx",color:"#FFFFFF",border:"none",borderRadius:"60px",background:"linear-gradient(90deg, var(--color-minor),var(--color-primary))"}),onClick:W,disabled:t.isReceiving},{default:o((()=>[u(" 立即生成 ")])),_:1},8,["style","disabled"])])),_:3}),n(ie,{ref_key:"keywordSuggestionRef",ref:z,modelValue:D(j).prompt,"onUpdate:modelValue":a[5]||(a[5]=e=>D(j).prompt=e)},null,8,["modelValue"])])),_:3})}}}),[["__scopeId","data-v-d7e997e0"]]),ue=x({__name:"model-picker",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(t,{emit:a}){const l=E({show:!1,current:{balance:1,name:"",model:""},modelList:[]}),s=e=>{l.current=l.modelList[e[0]],a("update:modelValue",l.current.model)};return(async()=>{try{const t=await e.get({url:"/draw/modelConfig"});l.modelList=t,l.current=t.find((e=>e.default))||t[0],a("update:modelValue",l.current.model)}catch(t){console.log("获取绘画模型失败=>",t)}})(),(e,t)=>{const a=g,i=v(y("u-icon"),$),c=f,m=v(y("u-picker"),ae);return r(),h(_,null,[l.modelList.length?(r(),h("div",{key:0,class:"flex items-center justify-between pb-[20rpx] text-xs"},[A(" 模型选择 "),n(c,{class:"inline-flex justify-center items-center rounded-[30px] h-[60rpx] px-[24rpx]",style:{"box-shadow":"0 2px 6px 0 rgba(0, 0, 0, 0.1)"},onClick:t[0]||(t[0]=e=>l.show=!0)},{default:o((()=>[n(a,{class:"text-[#415058] mr-[6px]"},{default:o((()=>[u(d(l.current.name),1)])),_:1}),n(i,{name:"arrow-down",size:"24rpx"})])),_:1}),n(c,{class:"ml-[10px] text-[#999999]"},{default:o((()=>[n(a,null,{default:o((()=>[u("消耗 ")])),_:1}),n(a,{class:"text-primary"},{default:o((()=>{var e;return[u(d((null==(e=null==l?void 0:l.current)?void 0:e.balance)||0),1)]})),_:1}),n(a,null,{default:o((()=>[u("条绘画条数")])),_:1})])),_:1})])):A("v-if",!0),n(m,{modelValue:l.show,"onUpdate:modelValue":t[1]||(t[1]=e=>l.show=e),"safe-area-inset-bottom":!0,"confirm-color":e.$theme.primaryColor,mode:"selector",range:l.modelList,"range-key":"name",onConfirm:s},null,8,["modelValue","confirm-color","range"])],64)}}}),de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAQAAACROWYpAAACxElEQVR42o3UX4iNWxjH8e+z3sWc6Jw659RxuDKn06nD6ZzD5MLNmOFGUsyk5MIFep+NSBQlVyJx54Ky13tBSlz4H+FGEUWaK9MQMoZQLlyRGXu/6yGz2+39jr35rN6bVb/Wu9Z6niUlKZuuYzN/MgWjlchrrtru7KW6EKkR0INsIeJozxBGbGk2mLqsFhdNCcAJjltOK0KU/9nO7wzI/HJFJRgAek9Nj4M62lAH2q1jatoP2pEKgGM2cAqYlCapV89XhahJuMkVoAvIhdSBpwNsDKxKTPiA9rCQn8kRmjkdpRNYrI7Hdj57mzoPgIBIMP2p4xh9GEJrc5mDyF5dFW6Mh41xR+mjwh1G8BgTJTiqeHqYzpm0t77HUNWF9APbwqGSK0daSCWz9C+5Sqfs8lDXDdwKhza4PGl39pqER7qfMt2N4V+BF5C7UGlcyRDJYsOMgT0V+M01lSAIBZlFlxtFBoijONkgdZDO9o/8Dig5KHK0IQ6kmz9YDuWYCgW+TUE6PFUcYGuSyWKiFqrfFQ6RqAAVwI7mFLQMqwTTv1lEru/pBaZrCZjMSLj4zXCwlcJJ/qt3eSdHgIhLF2XXScjbhL+8LieBUXJmMJN3DGFM4hUPgUh9ZQMSmpQNwgEOqA9V3chhBsP88cJsvk7Hc5B/Jl5bvUCt9pFZyak07/ka69mhd8NtrND+ggAJkPTLDD5KsV2c7WGYaVzTMyxo3kAwi2DDwJuzVpEQKXDZK5YxyFT6mFX89SyH7LL1sAnMaCQAXl24X5pnS/mXJXQRoSi7ARBsYg/4ENUxxrlwWqfQhQeS1GiUYETqxJPLVOCDrx2NJ+cB0KuzwpC6pv3lNNkQgdXAkFAvyPQXGWAmT9hnz0iwls9/B2tZAahQv9cQtZcL/IghtBdxHAxbE2oG7HN8uOsS0z6PH7CWA0Z5yM6wvySfABTwHNHdRSKKAAAAAElFTkSuQmCC",Ae=x({__name:"drawing-loading",setup:e=>(e,t)=>{const a=v(y("u-loading"),q),l=f;return r(),h(_,null,[A("    绘画中    "),n(l,{class:"flex flex-col justify-center items-center w-[500rpx] h-[500rpx] px-[50rpx] bg-page"},{default:o((()=>[n(a,{mode:"circle",color:e.$theme.primaryColor,size:"40"},null,8,["color"]),n(l,{class:"text-primary text-sm mt-[20rpx]"},{default:o((()=>[u(" 正在绘画中 ")])),_:1}),A('        <view class="mt-[50rpx] w-[400rpx]">'),A("            <u-line-progress"),A('                :active-color="$theme.primaryColor"'),A('                :percent="progress"'),A('                :height="16"'),A('                :show-percent="false"'),A("            ></u-line-progress>"),A("        </view>")])),_:1})],2112)}}),me=x({__name:"drawing-status",props:{content:{default:""}},setup:e=>(t,a)=>{const l=B,i=f;return r(),s(i,{class:"h-full flex flex-col justify-center items-center"},{default:o((()=>[n(l,{class:"w-[300rpx] h-[300rpx]",src:ne}),n(i,{class:"text-muted text-center mt-[30px]"},{default:o((()=>[u(d(e.content),1)])),_:1})])),_:1})}}),pe=t(x({__name:"drawing-picture",props:{picture:{default:""}},emits:["preview"],setup(e,{emit:t}){const a=(e,a)=>{e?z({current:a,urls:e}):t("preview")};return(t,l)=>{const i=v(y("u-loading"),q),c=f,d=v(y("u-image"),le);return r(),h("div",{class:"preview-picture"},[A("    单张图片    "),Array.isArray(e.picture)?(r(),h(_,{key:1},[A("    多张图片    "),(r(!0),h(_,null,C(e.picture,((t,l)=>(r(),s(d,{class:"image__item",width:"240",mode:"widthFix",key:l,src:t,onClick:t=>a(e.picture,l)},null,8,["src","onClick"])))),128))],64)):(r(),s(d,{key:0,src:e.picture,width:"500",height:"100%",mode:"widthFix",onClick:a},{loading:o((()=>[n(c,{class:"flex flex-col justify-center items-center w-full h-[500rpx] bg-[#F7F9FD]"},{default:o((()=>[n(i,{mode:"circle",color:t.$theme.primaryColor,size:"40"},null,8,["color"]),n(c,{class:"text-primary text-sm mt-[20rpx]"},{default:o((()=>[u(" 加载中 ")])),_:1})])),_:1})])),_:1},8,["src"]))])}}}),[["__scopeId","data-v-d5375162"]]),ge=t(x({__name:"drawing-record",props:{current:{default:0},contentList:{default:[]},isReceiving:{type:Boolean,default:!1},formData:{default:{actions:[],prompt:"",prompt_en:"",progress:0,task_id:"",image_id:"",image_url:""}}},emits:["change","drawing","delete","split","update:current","update:modelValue"],setup(e,{emit:t}){const l=e,c=a(""),m=async e=>{try{const{copy:t}=se();await t(e),uni.$u.toast("复制成功")}catch(t){uni.$u.toast("复制失败"),console.log("复制失败",t)}},p=(e,a)=>{const l=e;l.action="upsample"+a,t("drawing",{drawing:l})},x=(e,a)=>{const l=e;l.action="variation"+a,t("drawing",{drawing:l})},w=[{icon:"download",name:"下载",func:e=>{Array.isArray(e.image_url)?uni.$u.toast("请点击自己想要保存的图片后长按保存～"):re(e.image_url)}},{icon:"edit-pen",name:"一键切图",func:async e=>{c.value="recordList",t("split",e.image_url),await j(),c.value=""}},{icon:"reload",name:"重新生成",func:async e=>{const a={action:"generate"};a.prompt=e.prompt,a.image_id="",a.scale=e.scale,a.image_base=e.image_base,console.log("重新生成"),t("drawing",{drawing:a})}},{icon:"trash",name:"删除",func:async e=>{(await H({title:"温馨提示",content:"是否删除当前绘画?",confirmColor:"#FFC94D"})).confirm&&t("delete",e.id)}}];return(a,b)=>{const R=v(y("u-loading"),q),k=f,F=v(y("u-icon"),$),I=v(y("u-image"),le),E=Q,D=g,V=B;return r(),s(E,{class:"h-full","scroll-y":!0,"scroll-into-view":c.value},{default:o((()=>[A("    空状态    "),e.contentList.length?(r(),h(_,{key:1},[A("    绘画记录    "),n(E,{class:"whitespace-nowrap",id:"recordList","scroll-x":!0},{default:o((()=>[n(k,{class:"py-[30rpx] inline-block"},{default:o((()=>[(r(!0),h(_,null,C(e.contentList,((c,d)=>(r(),s(k,{key:d,class:i(["record-item",{"record-item_active":d==e.current}]),onClick:e=>((e,a)=>{l.isReceiving||(t("change",e),t("update:current",a))})(c,d)},{default:o((()=>[n(I,{src:c.image_url,width:"160",height:"160"},{error:o((()=>[2!=c.status?(r(),s(k,{key:0,class:"flex flex-col justify-center items-center bg-page w-full h-full"},{default:o((()=>[n(R,{mode:"circle",color:a.$theme.primaryColor,size:"40"},null,8,["color"]),n(k,{class:"text-primary text-sm mt-[10rpx]"},{default:o((()=>[u(" 生成中... ")])),_:1})])),_:1})):(r(),s(k,{key:1,class:"text-xs"},{default:o((()=>[n(F,{name:"error-circle",size:"44"})])),_:1}))])),_:2},1032,["src"])])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),A("    绘画结果    "),n(k,{class:"flex justify-center items-center w-full mt-[20rpx]"},{default:o((()=>[A("    绘画图片    "),e.formData.image_url&&!e.isReceiving?(r(),s(pe,{key:0,picture:e.formData.image_url,onPreview:b[0]||(b[0]=t=>(e=>{const t=e.map((e=>e.image_url));z({current:l.current,urls:t})})(e.contentList))},null,8,["picture"])):A("v-if",!0),A("    绘画中    "),e.isReceiving?(r(),s(Ae,{key:1})):A("v-if",!0),A("    绘画错误    "),e.isReceiving||e.formData.image_url?A("v-if",!0):(r(),s(me,{key:2,content:e.formData.fail_reason},null,8,["content"]))])),_:1}),A("    绘画结果属性    "),e.isReceiving||-1==e.current?A("v-if",!0):(r(),s(k,{key:0,class:"pb-[60px]"},{default:o((()=>[n(k,{class:"drawing-property"},{default:o((()=>{var t,a;return[A("    原始关键词    "),n(k,null,{default:o((()=>[n(k,{class:"my-[8rpx]",onClick:b[1]||(b[1]=t=>m(e.formData.prompt))},{default:o((()=>[n(D,{class:"text-base"},{default:o((()=>[u("原始关键词")])),_:1}),n(V,{class:"w-[30rpx] h-[30rpx] ml-[16rpx]",src:de})])),_:1}),n(k,{class:"px-[20rpx] py-[12rpx] bg-page rounded-[6rpx] text-base max-h-[240rpx] overflow-y-auto"},{default:o((()=>[u(d(e.formData.prompt),1)])),_:1})])),_:1}),A("    英文关键词    "),e.formData.prompt_en?(r(),s(k,{key:0},{default:o((()=>[n(k,{class:"my-[8rpx]",onClick:b[2]||(b[2]=t=>m(e.formData.prompt_en))},{default:o((()=>[n(D,{class:"text-base"},{default:o((()=>[u("英文关键词")])),_:1}),n(V,{class:"w-[30rpx] h-[30rpx] ml-[16rpx]",src:de})])),_:1}),n(k,{class:"px-[20rpx] py-[12rpx] bg-page rounded-[6rpx] text-base max-h-[240rpx] overflow-y-auto"},{default:o((()=>[u(d(e.formData.prompt_en),1)])),_:1})])),_:1})):A("v-if",!0),A("    放大图片    "),2!=(null==(t=e.formData)?void 0:t.status)&&!e.formData.actions.includes("low_variation1")&&e.formData.able_edit?(r(),s(k,{key:1,class:"mt-[30rpx]"},{default:o((()=>[n(k,{class:"mt-[8rpx]"},{default:o((()=>[n(D,{class:"text-base"},{default:o((()=>[u("放大图片")])),_:1}),n(D,{class:"text-xs text-muted ml-[16rpx]"},{default:o((()=>[u(" 对上面的其中一张图片进行放大 ")])),_:1})])),_:1}),n(k,{class:"flex justify-between mt-[20rpx]"},{default:o((()=>[n(k,{class:"property__btn",onClick:b[3]||(b[3]=t=>p(e.formData,1))},{default:o((()=>[u(" 左上 ")])),_:1}),n(k,{class:"property__btn",onClick:b[4]||(b[4]=t=>p(e.formData,2))},{default:o((()=>[u(" 右上 ")])),_:1}),n(k,{class:"property__btn",onClick:b[5]||(b[5]=t=>p(e.formData,3))},{default:o((()=>[u(" 左下 ")])),_:1}),n(k,{class:"property__btn",onClick:b[6]||(b[6]=t=>p(e.formData,4))},{default:o((()=>[u(" 右下 ")])),_:1})])),_:1})])),_:1})):A("v-if",!0),A("    变体图片    "),2!=(null==(a=e.formData)?void 0:a.status)&&!e.formData.actions.includes("low_variation1")&&e.formData.able_edit?(r(),s(k,{key:2,class:"mt-[30rpx]"},{default:o((()=>[n(k,{class:"mt-[8rpx]"},{default:o((()=>[n(D,{class:"text-base"},{default:o((()=>[u("变体图片")])),_:1}),n(D,{class:"text-xs text-muted ml-[16rpx]"},{default:o((()=>[u(" 对上面的其中一张图片进行多样化修改 ")])),_:1})])),_:1}),n(k,{class:"flex justify-between mt-[20rpx]"},{default:o((()=>[n(k,{class:"property__btn",onClick:b[7]||(b[7]=t=>x(e.formData,1))},{default:o((()=>[u(" 左上 ")])),_:1}),n(k,{class:"property__btn",onClick:b[8]||(b[8]=t=>x(e.formData,2))},{default:o((()=>[u(" 右上 ")])),_:1}),n(k,{class:"property__btn",onClick:b[9]||(b[9]=t=>x(e.formData,3))},{default:o((()=>[u(" 左下 ")])),_:1}),n(k,{class:"property__btn",onClick:b[10]||(b[10]=t=>x(e.formData,4))},{default:o((()=>[u(" 右下 ")])),_:1})])),_:1})])),_:1})):A("v-if",!0),A("    更多操作    "),n(k,{class:"mt-[30rpx]"},{default:o((()=>[n(k,{class:"mt-[8rpx]"},{default:o((()=>[n(D,{class:"text-base"},{default:o((()=>[u("更多操作")])),_:1})])),_:1}),n(k,{class:"flex flex-wrap mt-[20rpx]"},{default:o((()=>[(r(),h(_,null,C(w,((t,a)=>n(k,{key:a,class:"property__btn !px-[40rpx] mb-[20rpx] mr-[20rpx]",onClick:a=>t.func(e.formData)},{default:o((()=>[n(F,{name:t.icon},null,8,["name"]),n(D,{class:i(["ml-[10rpx]",t.className])},{default:o((()=>[u(d(t.name),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})]})),_:1})])),_:1}))],64)):(r(),s(me,{key:0,content:"暂无生成记录"}))])),_:1},8,["scroll-into-view"])}}}),[["__scopeId","data-v-3ba5043b"]]);const fe=t(x({__name:"drawing",setup(t){const l=U(),i=k(),c=R(),u=E({current:0,lists:[{name:"AI绘画",value:0},{name:"生成记录",value:0}]}),d=a(!1),A=a(!1),m=a(""),p=a(0),g=E({current:0,lists:[]}),x=E({actions:[],prompt:"",prompt_en:"",fail_reason:"",status:"",task_id:"",image_id:"",image_url:""}),w={prompt:"",action:"generate",image_base:"",image_id:"",scale:"1:1"},C=E(w),B=e=>{u.current=e},{start:Q,end:b}=(t=>{const l=async()=>{await I(),d.value=!1,g.current=0,await c.getUser()},{start:r,end:s,result:o}=function(e,t){const l=a(null),r=a(null),{time:s=2e3,totalTime:o,count:n,callback:i=(()=>!1)}=t??{};let c=null,u=null,d=0;const A=()=>(console.log("count2:",n),u&&u<=Date.now()||n&&d>=n?(m(),void i()):(d++,void(c=setTimeout((()=>{e().then((e=>{l.value=e,A()})).catch((e=>{r.value=e}))}),s)))),m=()=>{setTimeout((()=>{clearTimeout(c),c=null,u=null,d=0}),0)};return{start:()=>{u=o?Date.now()+o:null,A()},end:m,error:r,result:l}}((async()=>{try{const a=await function(t){return e.get({url:"/draw_records/detail",data:t})}({records_id:t.value});return Reflect.ownKeys(a).map((e=>{x[e]=a[e]})),g.lists[0]=x,3!=a.status&&2!=a.status||(s(),l()),a}catch(a){s(),console.log("获取详情失败=>",a)}}),{totalTime:48e4,time:5e3,count:96,callback:l});return{start:r,end:s,result:o}})(p);T((()=>{b()})),P((()=>{b()}));const F=e=>{Reflect.ownKeys(e).map((t=>{x[t]=e[t]}))},I=async()=>{try{const a=await(t={},e.get({url:"/draw_records/records",data:t}));0!=a.length&&Reflect.ownKeys(a[0]).map((e=>{x[e]=a[0][e]})),g.lists=a,1==x.status&&(d.value=!0,p.value=x.id,u.current=1,Q()),console.log(x)}catch(a){console.log("获取绘画记录失败=>",a)}var t},V=async t=>{try{await(a={ids:[t]},e.post({url:"/draw_records/delete",data:a,method:"POST"})),await I()}catch(l){console.log("删除绘画记录失败=>",l)}var a},K=async e=>{if(!A.value&&!Array.isArray(x.image_url)){S({title:"切图中"}),A.value=!0;try{const{getImages:t}=((e,t)=>{const{columns:a,rows:l}=t;if(!e)throw Error("请传入图片地址");if(!a&&!l)throw Error("请传入columns和rows");const r=async(e,t,a)=>{const l=document.createElement("canvas");l.width=e,l.height=t;const r=l.getContext("2d");return r.drawImage(a,0,0,e,t),s(r)},s=e=>{const t=e.canvas.width/a,r=e.canvas.height/l,s=[];for(let n=0;n<l;n++){const l=[];for(let s=0;s<a;s++){const a=o(e,s*t,n*r,t,r);l.push(a)}s.push(...l)}return s},o=(e,t,a,l,r)=>{const s=document.createElement("canvas");s.width=l,s.height=r;const o=e.getImageData(t,a,l,r);return s.getContext("2d").putImageData(o,0,0),s.toDataURL("image/png",1)};return{getImages:()=>new Promise(((t,a)=>{const l=new Image;l.setAttribute("src",e+"?"+(new Date).getTime()),l.setAttribute("crossOrigin",""),l.onload=()=>{t(r(l.width,l.height,l))},l.onerror=e=>{a(e)}}))}})(e,{columns:2,rows:2}),a=await t();x.image_url=a,A.value=!1,G()}catch(t){G(),A.value=!1,uni.$u.toast("下载图片超时，请重试"),console.log("一键切图失败=>",t)}}},{lockFn:Y,isLock:N}=ee((async t=>{if(console.log(t.drawing),d.value)u.current=1;else{if(!c.isLogin)return l.navigateTo("/pages/login/login");if(!t.drawing.prompt)return uni.$u.toast("请输入绘画描述！");d.value=!0,u.current=1,g.current=0,x.image_url="",g.lists.unshift({...x,image_url:""});try{const{records_id:l}=await(a={...t.drawing,model:m.value},e.post({url:"/draw/imagine",data:a,method:"POST",timeout:12e4}));t.isClear&&Object.assign(C,w),p.value=l,Q()}catch(r){if(g.lists.splice(0,1),g.current=-1,"余额不足"===r)return void z();console.log("绘制失败=>",r),x.fail_reason=r,await I(),d.value=!1}var a}})),z=async()=>{(await H({title:"绘画余额不足",content:"绘画余额不足，请前往充值",confirmText:"前往充值"})).confirm&&(c.isLogin?l.navigateTo("/packages/pages/recharge/recharge"):l.navigateTo("/pages/login/login"))};return L((()=>{I()})),(e,t)=>{const a=v(y("page-meta"),J),l=v(y("u-empty"),O),c=f,A=v(y("u-tabs"),W),p=v(y("tabbar"),X);return r(),h(_,null,[n(a,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),D(i).getDrawConfig.is_open?(r(),s(c,{key:1,class:"drawing-container"},{default:o((()=>[n(A,{list:u.lists,"is-scroll":!0,current:u.current,"active-color":e.$theme.primaryColor,"bg-color":"transparent",barStyle:{background:e.$theme.primaryColor},onChange:B},null,8,["list","current","active-color","barStyle"]),n(c,{class:"drawing-content"},{default:o((()=>[M(n(c,{class:"h-full"},{default:o((()=>[n(ce,{class:"h-full",modelValue:C,"onUpdate:modelValue":t[1]||(t[1]=e=>C=e),onDrawing:D(Y)},{model:o((()=>[n(ue,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e)},null,8,["modelValue"])])),_:1},8,["modelValue","onDrawing"])])),_:1},512),[[Z,0==u.current]]),M(n(c,{class:"h-full"},{default:o((()=>[n(ge,{class:"h-full",formData:x,current:g.current,"onUpdate:current":t[2]||(t[2]=e=>g.current=e),isReceiving:d.value,contentList:g.lists,onChange:F,onDrawing:D(Y),onDelete:V,onSplit:K},null,8,["formData","current","isReceiving","contentList","onDrawing"])])),_:1},512),[[Z,1==u.current]])])),_:1})])),_:1})):(r(),s(c,{key:0,class:"w-full h-full bg-white rounded-[6px] flex items-center justify-center"},{default:o((()=>[n(l,{text:"绘画功能未开启",mode:"favor"})])),_:1})),n(p)],64)}}}),[["__scopeId","data-v-59b90db7"]]);export{fe as default};
