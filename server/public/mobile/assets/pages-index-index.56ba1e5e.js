import{d as e,r as l,c as t,w as a,a as s,b as o,o as n,e as u,f as i,g as r,h as p,t as c,u as d,i as m,F as f,j as x,n as _,k as g,l as v,m as y,S as h,p as k,q as b,I as V,s as w,v as C,x as j,y as I,z as L,N as U,A as S,B as z,C as B,D,E as T,G as A,H as E,J as R,K as F,L as H,_ as P}from"./index-5fd89c82.js";import{_ as G}from"./page-meta.e1766212.js";import{_ as J}from"./u-icon.a1449c4b.js";import{u as K,i as M,_ as N,a as W,b as $}from"./icon_member.69f665f0.js";import{_ as q}from"./tabbar.vue_vue_type_script_setup_true_lang.f97ce269.js";import{_ as O}from"./u-button.ea6057e5.js";import{_ as Q}from"./u-popup.f70e8582.js";import{u as X}from"./useLockFn.b0443122.js";import{_ as Y}from"./u-input.89121eb6.js";import{_ as Z}from"./u-parse.ad11c7e7.js";import{g as ee,c as le,a as te}from"./chat.b5adffe9.js";import{_ as ae}from"./u-empty.c5bbad9c.js";import"./u-loading.e1adf064.js";import"./useCopy.dbed25b8.js";import"./text-item.vue_vue_type_script_setup_true_lang.eddf7716.js";import"./_commonjsHelpers.8b4586d6.js";import"./u-picker.81fd0f22.js";import"./index.3e35f6de.js";import"./l-painter.bfe68192.js";import"./u-badge.c3ab894f.js";import"./emitter.1571a5d9.js";const se=e({__name:"session-item",props:{modelValue:null,name:null,itemId:null},emits:["update:modelValue","edit","delete"],setup(e,{emit:v}){const y=e,h=l(""),k=l(!1),b=t({get:()=>y.modelValue,set(e){v("update:modelValue",e)}}),V=t((()=>b.value===y.itemId)),w=()=>{k.value=!1,v("edit",y.itemId,h.value)};return a((()=>y.modelValue),(()=>{k.value=!1})),a((()=>y.name),(e=>{h.value=e}),{immediate:!0}),(l,t)=>{const a=s(o("u-icon"),J),y=s(o("u-input"),Y),C=g;return n(),u(C,{class:_(["px-[20rpx] h-[80rpx] flex items-center rounded-[8rpx] mb-[20rpx] cursor-pointer",{" bg-page":d(V)}]),onClick:t[4]||(t[4]=l=>b.value=e.itemId)},{default:i((()=>[r(a,{name:"chat"}),r(C,{class:"ml-[20rpx] flex-1 min-w-0"},{default:i((()=>[k.value?(n(),u(y,{key:0,height:"50","custom-style":{fontSize:"26rpx"},modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),border:""},null,8,["modelValue"])):(n(),u(C,{key:1,class:"line-clamp-1"},{default:i((()=>[p(c(e.name),1)])),_:1}))])),_:1}),d(V)?(n(),m(f,{key:0},[k.value?(n(),m(f,{key:0},[r(C,{class:"cursor-pointer mx-[12rpx] flex h-full",onClick:w},{default:i((()=>[r(a,{name:"checkbox-mark"})])),_:1}),r(C,{class:"cursor-pointer flex h-full",onClick:t[1]||(t[1]=e=>k.value=!1)},{default:i((()=>[r(a,{name:"close"})])),_:1})],64)):(n(),m(f,{key:1},[r(C,{class:"cursor-pointer mr-[12rpx] flex h-full",onClick:t[2]||(t[2]=e=>k.value=!0)},{default:i((()=>[r(a,{name:"edit-pen"})])),_:1}),r(C,{class:"cursor-pointer flex h-full",onClick:t[3]||(t[3]=l=>v("delete",e.itemId))},{default:i((()=>[r(a,{name:"trash"})])),_:1})],64))],64)):x("v-if",!0)])),_:1},8,["class"])}}}),oe=e({__name:"session-popup",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const a=e,c=t({get:()=>a.modelValue,set:e=>{l("update:modelValue",e)}}),{sessionLists:x,sessionAdd:_,sessionEdit:k,sessionDelete:b,sessionClear:V,sessionActive:w}=K(),{lockFn:C,isLock:j}=X((async()=>{await _()}));return(e,l)=>{const t=s(o("u-button"),O),a=g,_=h,I=s(o("u-popup"),Q);return n(),u(I,{modelValue:d(c),"onUpdate:modelValue":l[1]||(l[1]=e=>y(c)?c.value=e:null),mode:"left",width:"480rpx","safe-area-inset-bottom":""},{default:i((()=>[r(a,{class:"flex flex-col h-full relative z-[9999]"},{default:i((()=>[r(a,{class:"px-[20rpx] py-[20rpx]"},{default:i((()=>[r(t,{type:"primary","custom-style":{width:"100%"},onClick:d(C),loading:d(j)},{default:i((()=>[p(" + 新建会话 ")])),_:1},8,["onClick","loading"])])),_:1}),r(a,{class:"flex-1 min-h-0"},{default:i((()=>[r(_,{"scroll-y":"",class:"h-full"},{default:i((()=>[r(a,{class:"px-[20rpx]"},{default:i((()=>[(n(!0),m(f,null,v(d(x),(e=>(n(),u(a,{key:e.id},{default:i((()=>[r(se,{modelValue:d(w),"onUpdate:modelValue":l[0]||(l[0]=e=>y(w)?w.value=e:null),"item-id":e.id,name:e.name,onEdit:d(k),onDelete:d(b)},null,8,["modelValue","item-id","name","onEdit","onDelete"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),r(a,{class:"px-[20rpx] py-[20rpx]"},{default:i((()=>[r(t,{"custom-style":{width:"100%"},onClick:d(V)},{default:i((()=>[p(" 删除所有会话 ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),ne=e({__name:"follow-official",props:{title:{default:"👉🏻关注公众号，下次访问不迷路"},show:{type:Boolean,default:!1}},setup(e){const t=l(!1),a=()=>{b.set(V,!0,86400),t.value=!1};return k((()=>{t.value=!b.get(V)})),(l,d)=>{const m=g,f=s(o("u-button"),O),_=C("router-navigate"),v=s(o("u-icon"),J);return e.show&&t.value?(n(),u(m,{key:0,class:"bg-primary flex px-[20rpx] items-center py-[16rpx]"},{default:i((()=>[r(m,{class:"flex-1 line-clamp-1 min-w-0 text-btn-text"},{default:i((()=>[p(c(e.title),1)])),_:1}),r(_,{to:"/pages/follow_official/follow_official"},{default:i((()=>[r(f,{class:"flex-none",plain:!0,type:"primary",size:"medium",shape:"circle","hover-class":"none","custom-style":{height:"60rpx"}},{default:i((()=>[p(" 前往关注 ")])),_:1})])),_:1}),r(m,{class:"text-btn-text ml-[10rpx]",onClick:w(a,["stop"])},{default:i((()=>[r(v,{name:"close"})])),_:1},8,["onClick"])])),_:1})):x("v-if",!0)}}}),ue=e({__name:"notice-popup",setup(e){const c=j(),m=l(!1),f=t((()=>c.getBulletinConfig.bulletin_content)),x=t((()=>c.getBulletinConfig.is_bulletin));a((()=>x.value),(e=>{e&&_(e)&&(m.value=!0)}),{deep:!0,immediate:!1});const _=e=>{const l=b.get(U),t=(new Date).toDateString(),a=!l||l!==t;return a&&e&&b.set(U,t),a};return(e,l)=>{const t=g,a=s(o("u-parse"),Z),c=h,x=L,_=s(o("u-popup"),Q);return n(),u(_,{modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=e=>m.value=e),mode:"center","border-radius":"24"},{default:i((()=>[r(t,{class:"w-[90vw] px-[24rpx]"},{default:i((()=>[r(t,{class:"p-[30rpx] text-lg text-center font-medium"},{default:i((()=>[p(" 公告 ")])),_:1}),r(c,{class:"max-h-[768rpx]","scroll-y":""},{default:i((()=>[r(a,{html:d(f)},null,8,["html"])])),_:1}),r(t,{class:"py-[30rpx] bg-white"},{default:i((()=>[r(x,{style:I({height:"82rpx",lineHeight:"82rpx",fontSize:"30rpx",border:"none",borderRadius:"60px",background:"var(--color-primary)"}),onClick:l[0]||(l[0]=e=>m.value=!1)},{default:i((()=>[p(" 我知道了 ")])),_:1},8,["style"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),ie=e({__name:"problem-example",props:{data:null},emits:["click-item","show-more"],setup(e,{emit:l}){const a=e,_=e=>e.slice(0,3),y=t((()=>_(a.data)));return(e,t)=>{const a=S,h=g,k=s(o("u-icon"),J);return n(),u(h,{class:"problem-example px-[10rpx]"},{default:i((()=>[r(h,{class:"flex"},{default:i((()=>[(n(!0),m(f,null,v(d(y),(e=>(n(),u(h,{key:e.id,class:"flex-1 mx-[10rpx]"},{default:i((()=>[r(h,{class:"flex flex-col justify-center items-center mb-[20rpx]"},{default:i((()=>[e.image?(n(),u(a,{key:0,class:"w-[88rpx] h-[88rpx]",src:e.image,alt:""},null,8,["src"])):x("v-if",!0),r(h,{class:"text-[30rpx] font-medium mt-[32rpx] line-clamp-1"},{default:i((()=>[p(c(e.name),1)])),_:2},1024)])),_:2},1024),r(h,null,{default:i((()=>[(n(!0),m(f,null,v(_(e.sample),(e=>(n(),u(h,{key:e.id,class:"bg-page mb-[20rpx] px-[20rpx] py-[15rpx] flex justify-center rounded-[12rpx] cursor-pointer",onClick:t=>{return a=e.content,void l("click-item",a);var a}},{default:i((()=>[r(h,{class:"line-clamp-2 text-sm text-center"},{default:i((()=>[p(c(e.content),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1}),r(h,{class:"py-[10rpx]",onClick:t[0]||(t[0]=e=>l("show-more"))},{default:i((()=>[r(h,{class:"text-sm text-muted flex items-center justify-center"},{default:i((()=>[p(" 查看更多 "),r(k,{name:"arrow-right",size:"26"})])),_:1})])),_:1})])),_:1})}}}),re=e({__name:"session",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const a=e,m=t({get:()=>a.modelValue,set:e=>{l("update:modelValue",e)}}),{currentSession:f}=K();return(e,l)=>{const t=s(o("u-icon"),J),a=g;return n(),u(a,{class:"bg-[#333] text-white flex items-center px-[20rpx] py-[24rpx]"},{default:i((()=>[r(t,{name:"list",size:40,onClick:l[0]||(l[0]=e=>m.value=!0)}),r(a,{class:"flex-1 line-clamp-1 ml-[20rpx]"},{default:i((()=>[p(c(d(f)),1)])),_:1})])),_:1})}}}),pe=e({__name:"problem-example-popup",props:{data:null,modelValue:{type:Boolean}},emits:["update:modelValue","click-item"],setup(e,{emit:a}){const x=e,k=t({get:()=>x.modelValue,set:e=>{a("update:modelValue",e)}}),b=l(0),V=t((()=>{var e;return(null==(e=x.data[b.value])?void 0:e.sample)||[]}));return(l,t)=>{const x=g,w=h,C=s(o("u-empty"),ae),j=s(o("u-popup"),Q);return n(),u(j,{modelValue:d(k),"onUpdate:modelValue":t[0]||(t[0]=e=>y(k)?k.value=e:null),height:"1000rpx",mode:"bottom","safe-area-inset-bottom":"","border-radius":"14",closeable:""},{default:i((()=>[r(x,{class:"py-[30rpx] h-full flex flex-col"},{default:i((()=>[r(x,{class:"text-2xl font-medium px-[30rpx]"},{default:i((()=>[p("问题示例")])),_:1}),r(x,null,{default:i((()=>[r(w,{"scroll-x":!0,class:"whitespace-nowrap"},{default:i((()=>[r(x,{class:"inline-block py-[20rpx]"},{default:i((()=>[r(x,{class:"flex px-[15rpx]"},{default:i((()=>[(n(!0),m(f,null,v(e.data,((e,l)=>(n(),u(x,{class:_(["mx-[15rpx] leading-[72rpx] px-[40rpx] bg-primary-light-9 text-primary rounded-[8rpx]",{"!text-btn-text !bg-primary":b.value==l}]),key:e.id,onClick:e=>b.value=l},{default:i((()=>[r(x,null,{default:i((()=>[p(c(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1}),r(x,{class:"border-0 border-t border-light border-solid flex-1 min-h-0 leading-[72rpx]"},{default:i((()=>[r(w,{class:"h-full","scroll-y":!0},{default:i((()=>[r(x,{class:"px-[30rpx] py-[20rpx]"},{default:i((()=>[d(V).length?(n(!0),m(f,{key:0},v(d(V),(e=>(n(),u(x,{key:e.id,class:"py-[10rpx]"},{default:i((()=>[r(x,{class:"text-center px-[20rpx] bg-page rounded",onClick:l=>{return t=e.content,k.value=!1,void a("click-item",t);var t}},{default:i((()=>[p(c(e.content),1)])),_:2},1032,["onClick"])])),_:2},1024)))),128)):(n(),u(x,{key:1,class:"py-[150rpx]"},{default:i((()=>[r(C,{text:"暂无数据",mode:"data"})])),_:1}))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),ce=P(e({__name:"index",setup(e){const{getSessionLists:t,sessionActive:_}=K(),y=l(!1),h=l(!1),k=R(),b=l([]),V=l([]),w=z(),C=z(),I=async()=>{const e=await ee({type:1,category_id:_.value,page_type:0});V.value=e.lists};let L=null;const U=e=>{L=e},S=e=>{null==L||L.cancel(),e&&(V.value[e].loading=!1)},P=async e=>{const l=V.value.filter((l=>l.id==e));2==l.length?C.value.initPosterData({title:l[0].content,content:l[1].content}):uni.$u.toast("上下文数据不对～")},O=B(),Q=j(),{userInfo:Y}=D(O),{lockFn:Z}=X((async()=>{if(!O.isLogin)return k.navigateTo({path:"/pages/login/login"});(await H({title:"温馨提示",content:"确定清空对话？"})).cancel||(await le({type:1,category_id:_.value}),I())})),ae=()=>{if(!O.isLogin)return k.navigateTo({path:"/pages/login/login"});k.navigateTo({path:"/packages/pages/open_vip/open_vip"})};return a(_,(async e=>{S(),e&&(await I(),setTimeout((()=>{var e,l;V.value.length?null==(l=w.value)||l.scrollToBottom():null==(e=w.value)||e.scrollTo(0)}),200)),(async()=>{b.value=await te()})()}),{immediate:!0}),T((async()=>{await t()})),A((()=>{S()})),(e,l)=>{const t=s(o("page-meta"),G),a=s(o("u-icon"),J),k=F,j=g,L=s(o("chat-record-item"),N),z=s(o("chat-scroll-view"),W),B=s(o("dialog-poster"),$),D=s(o("tabbar"),q);return n(),m(f,null,[r(t,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),r(j,{class:"h-full flex flex-col"},{default:i((()=>[r(ne,{show:!!d(Q).config.is_follow_official,title:d(Q).getLoginConfig.involved_text},null,8,["show","title"]),r(re,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=e=>y.value=e)},null,8,["modelValue"]),r(j,{class:"px-[30rpx] py-[26rpx] text-sm flex items-center bg-white"},{default:i((()=>[r(j,{class:"flex-1"},{default:i((()=>[d(Q).getIsShowVip?(n(),u(j,{key:0,class:"flex items-center",onClick:ae},{default:i((()=>[r(a,{size:34,name:d(M)},null,8,["name"]),r(k,{class:"ml-[10rpx]"},{default:i((()=>[p(c(d(Y).is_member?"已开通会员，对话不消耗条数":"开通会员"),1)])),_:1})])),_:1})):x("v-if",!0)])),_:1}),r(j,{class:"text-muted",onClick:d(Z)},{default:i((()=>[p(" 清空对话 ")])),_:1},8,["onClick"])])),_:1}),r(j,{class:"flex-1 min-h-0 bg-white"},{default:i((()=>[r(z,{modelValue:V.value,"onUpdate:modelValue":l[3]||(l[3]=e=>V.value=e),ref_key:"chatRef",ref:w,type:1,categoryId:d(_),bottom:100,safeAreaInsetBottom:!1,onEnd:I,onReader:U},{default:i((()=>[r(j,{class:"bg-white scroll-view-content"},{default:i((()=>[V.value.length?x("v-if",!0):(n(),m(f,{key:0},[E("div",{class:"my-[60rpx] text-center text-[50rpx] font-medium"},c(d(Q).getWebsiteConfig.shop_name),1),b.value.length?(n(),u(ie,{key:0,data:b.value,onClickItem:l[1]||(l[1]=e=>d(w).sendLock(e)),onShowMore:l[2]||(l[2]=e=>h.value=!0)},null,8,["data"])):x("v-if",!0)],64)),d(Q).getChatConfig.is_tip?(n(),u(j,{key:1,class:"bg-page flex flex-col items-center p-[30rpx] mt-[20rpx] m-[40rpx]"},{default:i((()=>[r(j,{class:"flex items-center"},{default:i((()=>[r(a,{name:"warning",size:40}),r(j,{class:"text-lg ml-[10rpx]"},{default:i((()=>[p("局限性")])),_:1})])),_:1}),r(j,{class:"text-content text-sm mt-[20rpx]"},{default:i((()=>[p(" 禁止利用AI进行非法活动 ")])),_:1})])),_:1})):x("v-if",!0),r(j,{class:"chat-record mt-[20rpx]"},{default:i((()=>[(n(!0),m(f,null,v(V.value,((e,l)=>(n(),u(L,{key:l,"record-id":e.id,type:1==e.type?"right":"left",content:e.content,loading:e.loading,"is-collect":e.is_collect,avatar:d(Q).getChatConfig.chat_logo,onUpdate:I,onClose:e=>S(l),onClickPoster:P},null,8,["record-id","type","content","loading","is-collect","avatar","onClose"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","categoryId"]),x("  生产对话海报  "),r(B,{ref_key:"posterRef",ref:C},null,512),x("  会话弹窗  "),r(oe,{modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=e=>y.value=e)},null,8,["modelValue"]),x("  会话弹窗  "),r(pe,{modelValue:h.value,"onUpdate:modelValue":l[5]||(l[5]=e=>h.value=e),data:b.value,onClickItem:l[6]||(l[6]=e=>d(w).sendLock(e))},null,8,["modelValue","data"]),x("  公告弹窗  "),r(ue)])),_:1}),r(D)])),_:1})],64)}}}),[["__scopeId","data-v-eb3cc50c"]]);export{ce as default};
