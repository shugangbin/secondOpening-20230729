import{d as e,J as a,r as t,P as s,a_ as l,c as r,C as o,w as u,bK as c,an as i,ao as d,$ as n,a as p,b as m,o as f,i as _,g as x,f as h,h as y,F as w,l as v,e as g,t as b,u as k,j as C,m as I,Y as A,bL as S,k as j,ax as P,bM as E,ay as L,_ as R,R as F,W as N,E as O,M as V,a6 as z,a7 as U,K as W,v as M}from"./index-5fd89c82.js";import{_ as B}from"./page-meta.e1766212.js";import{_ as D}from"./u-image.adbe7f0a.js";import{P as q,b as G,_ as X,p as $,a as H,g as K}from"./check.vue_vue_type_script_setup_true_lang.ee492da0.js";import{_ as J}from"./u-button.ea6057e5.js";import{_ as T}from"./u-empty.c5bbad9c.js";import{_ as Y}from"./u-icon.a1449c4b.js";import{_ as Q,a as Z}from"./u-radio-group.e1a3a044.js";import{_ as ee}from"./page-status.09beba2a.js";import{_ as ae}from"./u-popup.f70e8582.js";import{u as te}from"./useLockFn.b0443122.js";import{_ as se}from"./tabbar.vue_vue_type_script_setup_true_lang.f97ce269.js";import"./emitter.1571a5d9.js";import"./u-loading.e1adf064.js";import"./u-badge.c3ab894f.js";const le=R(e({__name:"payment",props:{show:{type:Boolean,required:!0},showCheck:{type:Boolean},orderId:{type:Number,required:!0},from:{type:String,required:!0},redirect:{type:String},orderAmount:{type:Number},safeArea:{type:Boolean,required:!0}},emits:["update:showCheck","update:show","close","success","fail"],setup(e,{emit:R}){const F=e;a();const N=t(),O=t(s.LOADING),V=t({lists:[]});l();const z=t({is_open:1,tips:"立即支付"}),U=r({get:()=>F.showCheck,set(e){R("update:showCheck",e)}}),W=r({get:()=>F.show,set(e){R("update:show",e)}}),M=()=>{W.value=!1,R("close")},B=o(),D=async e=>{try{A({title:"正在支付中"});const a=await $({order_id:F.orderId,from:F.from,pay_way:N.value,redirect:F.redirect,code:e});return await H.payment(a.pay_way,a.config)}catch(a){return Promise.reject(a)}},{isLock:se,lockFn:le}=te((async()=>{try{const e=await(async()=>{if(0==B.userInfo.is_auth&&[P.OA_WEIXIN,P.MP_WEIXIN].includes(E)&&N.value==q.WECHAT)switch(E){case P.OA_WEIXIN:return i.getUrl(d.BASE,"snsapi_base",{id:F.orderId,from:F.from}),Promise.reject();case P.MP_WEIXIN:return(await L()).code}})(),a=await D(e);re(a),n()}catch(e){n(),console.log(e)}})),re=e=>{switch(e){case S.SUCCESS:R("success");break;case S.FAIL:R("fail")}},oe=()=>{re(S.SUCCESS)},ue=()=>{W.value=!0,re(S.FAIL)};return u((()=>F.show),(async e=>{if(e){if(!F.orderId)return void(O.value=s.ERROR);await(async()=>{O.value=s.LOADING;try{V.value=await K({order_id:F.orderId,from:F.from}),O.value=s.NORMAL;const e=V.value.lists.find((e=>e.is_default))||V.value.lists[0];N.value=null==e?void 0:e.pay_way}catch(e){O.value=s.ERROR}})()}}),{immediate:!0}),c((async()=>{const e=i.getAuthData();if(e.code&&e.scene===d.BASE){N.value=q.WECHAT,W.value=!0;try{const a=await D(e.code);re(a),n()}catch(a){n(),console.log(a)}finally{i.setAuthData({})}}})),(a,t)=>{const s=p(m("u-empty"),T),l=j,r=p(m("u-icon"),Y),o=p(m("u-radio"),Q),u=p(m("u-radio-group"),Z),c=p(m("price"),G),i=p(m("u-button"),J),d=p(m("page-status"),ee),n=p(m("u-popup"),ae);return f(),_(w,null,[x(n,{modelValue:k(W),"onUpdate:modelValue":t[1]||(t[1]=e=>I(W)?W.value=e:null),mode:"bottom","safe-area-inset-bottom":e.safeArea,"mask-close-able":!1,"border-radius":"14",closeable:"","z-index":899,onClose:M},{default:h((()=>[x(l,{class:""},{default:h((()=>[x(d,{status:O.value,fixed:!1},{error:h((()=>[x(s,{text:"订单信息错误，无法查询到订单信息",mode:"order"})])),default:h((()=>[x(l,{class:"payment w-full pb-[20rpx]"},{default:h((()=>[x(l,{class:"header py-[50rpx] flex flex-col items-center"},{default:h((()=>[x(l,{class:"text-[34rpx]"},{default:h((()=>[y("选择支付方式")])),_:1})])),_:1}),x(l,{class:"main min-h-[300rpx] mx-[20rpx]"},{default:h((()=>[x(l,null,{default:h((()=>[x(l,{class:"payway-lists"},{default:h((()=>[x(u,{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=e=>N.value=e),class:"w-full","active-color":a.$theme.primaryColor},{default:h((()=>[(f(!0),_(w,null,v(V.value.lists,((e,a)=>(f(),g(l,{class:"p-[20rpx] flex items-center w-full payway-item",key:a,onClick:a=>{return t=e.pay_way,void(N.value=t);var t}},{default:h((()=>[x(r,{class:"flex-none",size:48,name:e.icon},null,8,["name"]),x(l,{class:"mx-[16rpx] flex-1"},{default:h((()=>[x(l,{class:"payway-item--name flex-1"},{default:h((()=>[y(b(e.name),1)])),_:2},1024),x(l,{class:"text-muted text-xs"},{default:h((()=>[y(b(e.extra),1)])),_:2},1024)])),_:2},1024),x(o,{class:"mr-[-20rpx]",name:e.pay_way},null,8,["name"])])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue","active-color"])])),_:1})])),_:1})])),_:1}),x(l,{class:"submit-btn p-[20rpx] mt-[50rpx]"},{default:h((()=>[x(i,{onClick:k(le),shape:"circle",type:"primary",loading:k(se),disabled:!z.value.is_open},{default:h((()=>[y(b(z.value.tips)+" ",1),e.orderAmount&&z.value.is_open?(f(),g(c,{key:0,content:e.orderAmount,mainSize:"34rpx",minorSize:"34rpx",fontWeight:"500",color:"var(--color-btn-text)"},null,8,["content"])):C("v-if",!0)])),_:1},8,["onClick","loading","disabled"])])),_:1})])),_:1})])),_:1},8,["status"])])),_:1})])),_:1},8,["modelValue","safe-area-inset-bottom"]),x(X,{show:k(U),"onUpdate:show":t[2]||(t[2]=e=>I(U)?U.value=e:null),from:e.from,"order-id":e.orderId,onSuccess:oe,onFail:ue},null,8,["show","from","order-id"])],64)}}}),[["__scopeId","data-v-49481150"]]);const re=R(e({__name:"recharge",setup(e){const a=t(s.LOADING),l=t({lists:[]}),r=t(),o=N({orderId:"",from:"recharge",showPay:!1,orderAmount:"",showCheck:!1,showPaySuccess:!1}),{isLock:u,lockFn:c}=te((async e=>{A({mask:!0,title:"请稍后..."});try{const a=await function(e){return F.post({url:"/recharge/recharge",data:e},{isAuth:!0})}({recharge_package_id:e});o.orderId=a.order_id,o.showPay=!0,o.orderAmount=a.order_amount}catch(a){}finally{n()}})),i=async()=>{o.showPay=!1,o.showPaySuccess=!0},d=async()=>{var e;l.value=await F.get({url:"/recharge/rechargePackage"},{isAuth:!0}),r.value=(null==(e=l.value.lists.find((e=>e.is_default)))?void 0:e.id)||""},I=async()=>{try{await Promise.all([d()]),a.value=s.NORMAL}catch(e){a.value=s.ERROR}};return O((()=>{I()})),V((e=>{e.id&&e.from&&(o.orderId=e.id,o.from=e.from),(null==e?void 0:e.checkPay)&&(o.showCheck=!0)})),z((async()=>{try{await I()}catch(e){}U()})),(e,t)=>{const s=p(m("page-meta"),B),u=j,d=p(m("u-image"),D),n=p(m("price"),G),I=p(m("u-button"),J),A=p(m("u-empty"),T),S=p(m("payment"),le),P=p(m("u-icon"),Y),E=W,L=M("router-navigate"),R=p(m("u-popup"),ae),F=p(m("page-status"),ee),N=p(m("tabbar"),se);return f(),_(w,null,[x(s,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),x(F,{status:a.value},{error:h((()=>[x(A,{text:"加载出错～"})])),default:h((()=>[l.value.status?(f(),g(u,{key:0,class:"task-center"},{default:h((()=>[x(u,{class:"pb-[20rpx]"},{default:h((()=>{var e;return[(null==(e=l.value.lists)?void 0:e.length)?(f(),g(u,{key:0,class:"recharge overflow-hidden"},{default:h((()=>[x(u,{class:"tasks-title"},{default:h((()=>[x(u,{class:"font-medium text-xl"},{default:h((()=>[y("充值套餐")])),_:1}),x(u,{class:"ml-[14rpx] text-muted text-sm"},{default:h((()=>[y(" VIP期间对话不消耗次数，次数永不过期 ")])),_:1})])),_:1}),x(u,{class:"recharge-template flex flex-wrap px-[30rpx] mx-[-10rpx]"},{default:h((()=>[(f(!0),_(w,null,v(l.value.lists,(e=>(f(),g(u,{class:"w-1/2 mb-[20rpx]",key:e.id,onClick:a=>r.value=e.id},{default:h((()=>[x(u,{class:"flex flex-col rounded-[16rpx] mx-[10rpx] h-full border-[1px] border-solid border-light overflow-hidden relative"},{default:h((()=>[x(u,{class:"pt-[60%] relative w-full h-0"},{default:h((()=>[x(u,{class:"absolute left-0 right-0 bottom-0 top-0"},{default:h((()=>[x(d,{width:"100%",height:"100%",src:e.image,mode:"aspectFill"},null,8,["src"])])),_:2},1024)])),_:2},1024),e.is_recommend?(f(),g(u,{key:0,class:"absolute top-[-1px] left-[-1px] bg-[#FF3232] text-white text-sm rounded-[8rpx] px-[20rpx] py-[8rpx]"},{default:h((()=>[y(" 强烈推荐 ")])),_:1})):C("v-if",!0),x(u,{class:"p-[20rpx] flex-1 min-h-0 flex flex-col"},{default:h((()=>[x(u,null,{default:h((()=>[x(n,{content:e.sell_price,mainSize:"40rpx",minorSize:"28rpx",color:"#FF2C3C",fontWeight:500},null,8,["content"])])),_:2},1024),x(u,{class:"text-xl font-medium mt-[12rpx] line-clamp-1"},{default:h((()=>[y(b(e.name),1)])),_:2},1024),x(u,{class:"text-sm text-muted mt-[20rpx] line-clamp-3"},{default:h((()=>[y(b(e.describe),1)])),_:2},1024),x(u,{class:"mt-auto"},{default:h((()=>[x(u,{class:"flex flex-wrap justify-between mt-[20rpx] text-sm"},{default:h((()=>[x(u,{class:"mr-[20rpx] flex-none"},{default:h((()=>[y(" 对话次数: "+b(e.number),1)])),_:2},1024),e.is_give&&e.give_number?(f(),g(u,{key:0,class:"text-primary"},{default:h((()=>[y(" +"+b(e.give_number),1)])),_:2},1024)):C("v-if",!0)])),_:2},1024),x(u,{class:"flex flex-wrap justify-between mt-[12rpx] text-sm"},{default:h((()=>[x(u,{class:"mr-[10px] flex-none"},{default:h((()=>[y(" 绘画次数: "+b(e.draw_number),1)])),_:2},1024),e.is_give&&e.give_draw_number?(f(),g(u,{key:0,class:"text-primary"},{default:h((()=>[y(" +"+b(e.give_draw_number),1)])),_:2},1024)):C("v-if",!0)])),_:2},1024),x(u,{class:"pt-[30rpx] pb-[10rpx]"},{default:h((()=>[x(I,{"custom-style":{width:"100%",height:"68rpx",fontSize:"28rpx"},type:"primary",shape:"circle",onClick:a=>k(c)(e.id)},{default:h((()=>[y(" 立即充值 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):C("v-if",!0)]})),_:1})])),_:1})):(f(),g(u,{key:1,class:"py-[400rpx]"},{default:h((()=>[x(A,{text:"功能未开启"})])),_:1})),x(S,{show:o.showPay,"onUpdate:show":t[0]||(t[0]=e=>o.showPay=e),"order-id":o.orderId,showCheck:o.showCheck,"onUpdate:showCheck":t[1]||(t[1]=e=>o.showCheck=e),from:o.from,redirect:"/packages/pages/recharge/recharge","order-amount":o.orderAmount,onSuccess:i},null,8,["show","order-id","showCheck","from","order-amount"]),x(R,{modelValue:o.showPaySuccess,"onUpdate:modelValue":t[3]||(t[3]=e=>o.showPaySuccess=e),"safe-area-inset-bottom":!0,"mask-close-able":!1,"border-radius":"14","z-index":899,round:"",mode:"center",width:"600"},{default:h((()=>[x(u,{class:"pt-[20rpx]"},{default:h((()=>[x(u,{class:"px-[30rpx] py-[40rpx]"},{default:h((()=>[x(u,{class:"text-success text-center"},{default:h((()=>[x(P,{name:"checkmark-circle-fill",size:"100"})])),_:1}),x(u,{class:"text-xl font-medium mt-[20rpx] text-center"},{default:h((()=>[y(" 支付成功 ")])),_:1}),x(u,{class:"flex mt-[60rpx]"},{default:h((()=>[x(u,{class:"flex-1"},{default:h((()=>[x(u,{class:"h-[72rpx] leading-[72rpx] rounded-full bg-page text-center",onClick:t[2]||(t[2]=e=>o.showPaySuccess=!1)},{default:h((()=>[x(E,null,{default:h((()=>[y("继续充值")])),_:1})])),_:1})])),_:1}),x(u,{class:"flex-1 ml-[20rpx]"},{default:h((()=>[x(L,{class:"h-[72rpx] leading-[72rpx] rounded-full bg-primary text-center text-btn-text",to:"/pages/index/index","nav-type":"reLaunch"},{default:h((()=>[x(E,null,{default:h((()=>[y("返回首页")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["status"]),x(N)],64)}}}),[["__scopeId","data-v-152ad071"]]);export{re as default};
