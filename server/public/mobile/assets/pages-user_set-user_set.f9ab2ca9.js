import{_ as e,a,b as t,o as l,e as s,f as u,y as o,g as r,h as i,t as n,j as c,i as d,F as p,l as m,s as f,n as v,K as x,k as h,d as _,C as b,r as y,al as g,B as w,am as k,E as V,M as C,an as I,ao as j,Y as B,q as z,ap as A,$ as S,u as $,aq as N,ar as U,as as T,Z as E,at as D,au as M,av as O,aw as R,ax as L,ay as W,az as X,Q as Z,z as G,aA as H}from"./index-5fd89c82.js";import{_ as K}from"./page-meta.e1766212.js";import{_ as q}from"./avatar-upload.ea30fce9.js";import{_ as F}from"./u-icon.a1449c4b.js";import{_ as P}from"./u-button.ea6057e5.js";import{_ as Q}from"./u-form-item.2be3ee00.js";import{_ as Y}from"./u-popup.f70e8582.js";import{_ as J}from"./u-input.89121eb6.js";import{_ as ee}from"./u-verification-code.500a5db0.js";import{u as ae}from"./useCopy.dbed25b8.js";import"./_commonjsHelpers.8b4586d6.js";import"./emitter.1571a5d9.js";const te=e({name:"u-action-sheet",emits:["update:modelValue","input","click","close"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},maskCloseAble:{type:Boolean,default:!0},list:{type:Array,default:()=>[]},tips:{type:Object,default:()=>({text:"",color:"",fontSize:"26"})},cancelBtn:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!1},borderRadius:{type:[String,Number],default:0},zIndex:{type:[String,Number],default:0},cancelText:{type:String,default:"取消"},labelName:{type:String,default:"text"},blur:{type:[Number,String],default:0}},computed:{valueCom(){return this.modelValue},tipsStyle(){let e={};return this.tips.color&&(e.color=this.tips.color),this.tips.fontSize&&(e.fontSize=this.tips.fontSize+"rpx"),e},itemStyle(){return e=>{let a={};return this.list[e].color&&(a.color=this.list[e].color),this.list[e].fontSize&&(a.fontSize=this.list[e].fontSize+"rpx"),this.list[e].disabled&&(a.color="#c0c4cc"),a}},uZIndex(){return this.zIndex?this.zIndex:this.$u.zIndex.popup}},data:()=>({popupValue:!1}),watch:{valueCom(e,a){this.popupValue=e}},methods:{close(){this.popupClose(),this.$emit("close")},popupClose(){this.$emit("input",!1),this.$emit("update:modelValue",!1)},itemClick(e){this.list[e].disabled||(this.$emit("click",e),this.$emit("input",!1),this.$emit("update:modelValue",!1))}}},[["render",function(e,_,b,y,g,w){const k=x,V=h,C=a(t("u-popup"),Y);return l(),s(C,{blur:b.blur,mode:"bottom","border-radius":b.borderRadius,popup:!1,modelValue:g.popupValue,"onUpdate:modelValue":_[2]||(_[2]=e=>g.popupValue=e),maskCloseAble:b.maskCloseAble,length:"auto",safeAreaInsetBottom:b.safeAreaInsetBottom,onClose:w.popupClose,"z-index":w.uZIndex},{default:u((()=>[b.tips.text?(l(),s(V,{key:0,class:"u-tips u-border-bottom",style:o([w.tipsStyle])},{default:u((()=>[r(k,null,{default:u((()=>[i(n(b.tips.text),1)])),_:1})])),_:1},8,["style"])):c("v-if",!0),(l(!0),d(p,null,m(b.list,((e,a)=>(l(),s(V,{key:a,onTouchmove:_[0]||(_[0]=f((()=>{}),["stop","prevent"])),onClick:e=>w.itemClick(a),style:o([w.itemStyle(a)]),class:v(["u-action-sheet-item u-line-1",[a<b.list.length-1?"u-border-bottom":""]]),"hover-stay-time":150},{default:u((()=>[r(k,null,{default:u((()=>[i(n(e[b.labelName]),1)])),_:2},1024),e.subText?(l(),s(k,{key:0,class:"u-action-sheet-item__subtext u-line-1"},{default:u((()=>[i(n(e.subText),1)])),_:2},1024)):c("v-if",!0)])),_:2},1032,["onClick","style","class"])))),128)),b.cancelBtn?(l(),s(V,{key:1,class:"u-gab"})):c("v-if",!0),b.cancelBtn?(l(),s(V,{key:2,onTouchmove:_[1]||(_[1]=f((()=>{}),["stop","prevent"])),class:"u-actionsheet-cancel u-action-sheet-item","hover-class":"u-hover-class","hover-stay-time":150,onClick:w.close},{default:u((()=>[i(n(b.cancelText),1)])),_:1},8,["onClick"])):c("v-if",!0)])),_:1},8,["blur","border-radius","modelValue","maskCloseAble","safeAreaInsetBottom","onClose","z-index"])}],["__scopeId","data-v-5831dcf0"]]),le=e(_({__name:"user_set",setup(e){const{copy:o}=ae(),m=b(),f=y({}),v=y(g.NONE),x=y(!1),_=y(!1),le=y(!1),se=y(!1),ue=y([{text:"修改密码"},{text:"忘记密码"}]),oe=y(""),re=y(""),ie=y(""),ne=y(""),ce=y(""),de=w(),pe=async()=>{f.value=await N()},me=e=>{ce.value=e},fe=async()=>{var e,a;if(!ie.value)return uni.$u.toast("请输入新的手机号码");(null==(e=de.value)?void 0:e.canGetCode)&&(await U({scene:f.value.mobile?T.CHANGE_MOBILE:T.BIND_MOBILE,mobile:ie.value}),uni.$u.toast("发送成功"),null==(a=de.value)||a.start())},ve=async e=>{B({title:"正在上传中..."});try{const a=await E(e);xe(a.uri),S()}catch(a){S(),uni.$u.toast(a)}},xe=e=>{v.value=g.AVATAR,_e(e)},he=async()=>{await D({type:f.value.mobile?"change":"bind",mobile:ie.value,code:ne.value}),uni.$u.toast("操作成功"),le.value=!1,pe()},_e=async e=>{await M({field:v.value,value:e}),uni.$u.toast("操作成功"),pe()},be=()=>""==re.value?uni.$u.toast("账号不能为空"):re.value.length>10?uni.$u.toast("账号长度不得超过十位数"):(v.value=g.USERNAME,_e(re.value),void(_.value=!1)),ye=async e=>(oe.value=e.detail.value.nickname,""==oe.value?uni.$u.toast("昵称不能为空"):oe.value.length>10?uni.$u.toast("昵称长度不得超过十位数"):(v.value=g.NICKNAME,await _e(oe.value),void(x.value=!1))),ge=()=>{O.navigateTo("/packages/pages/cancelaccount/cancelaccount")},we=()=>{if(!f.value.has_password)return O.navigateTo("/pages/change_password/change_password?type=set");se.value=!0},ke=e=>{switch(e){case 0:O.navigateTo("/pages/change_password/change_password");break;case 1:O.navigateTo("/pages/forget_pwd/forget_pwd")}},Ve=()=>{m.logout(),O.reLaunch("/pages/index/index")},Ce=y(!0);Ce.value=k();const Ie=async()=>{if(!(null==f?void 0:f.value.has_auth)){B({title:"请稍后..."});try{if(R()==L.MP_WEIXIN){const{code:e}=await W({provider:"weixin"});await X({code:e})}else R()==L.OA_WEIXIN&&I.getUrl(j.BIND_WX)}catch(e){uni.$u.toast(e)}finally{S()}}};return V((async()=>{pe()})),C((async e=>{const{code:a,scene:t}=I.getAuthData();if(a.length&&t===j.BIND_WX){B({title:"请稍后..."}),z.set("code",a);try{await A({code:a})}catch(l){}finally{S(),I.setAuthData()}}})),(e,m)=>{const v=a(t("page-meta"),K),b=a(t("avatar-upload"),q),y=h,g=a(t("u-icon"),F),w=a(t("u-button"),P),k=Z,V=a(t("u-form-item"),Q),C=G,I=H,j=a(t("u-popup"),Y),B=a(t("u-input"),J),z=a(t("u-verification-code"),ee),A=a(t("u-action-sheet"),te);return l(),d(p,null,[r(v,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),r(y,{class:"user-set p-[20rpx]"},{default:u((()=>{var e;return[r(y,{class:"bg-white rounded-[14rpx]"},{default:u((()=>[r(y,{class:"header pt-[30rpx]"},{default:u((()=>[r(y,{class:"flex justify-center pb-5"},{default:u((()=>[r(b,{modelValue:f.value.avatar,"onUpdate:modelValue":m[0]||(m[0]=e=>f.value.avatar=e),"file-key":"url",round:!0,onUpload:ve},{footer:u((()=>[])),_:1},8,["modelValue"])])),_:1})])),_:1}),r(y,{class:"px-[20rpx]"},{default:u((()=>[c(" 用户ID "),c("                <view"),c('                    class="item text-nr flex justify-between"'),c('                    @click="'),c("                        ;(showUserName = true),"),c("                            (newUsername = userInfo?.username)"),c('                    "'),c("                >"),c('                    <view class="label">账号</view>'),c('                    <view class="content">{{ userInfo?.account }}</view>'),c('                    <u-icon name="arrow-right" size="22" color="#666"></u-icon>'),c("                </view>"),c(" 昵称 "),r(y,{class:"item text-nr flex justify-between",onClick:m[1]||(m[1]=e=>{var a;x.value=!0,oe.value=null==(a=f.value)?void 0:a.nickname})},{default:u((()=>[r(y,{class:"label"},{default:u((()=>[i("昵称")])),_:1}),r(y,{class:"content"},{default:u((()=>{var e;return[i(n(null==(e=f.value)?void 0:e.nickname),1)]})),_:1}),r(g,{name:"arrow-right",size:"22",color:"#666"})])),_:1}),r(y,{class:"item text-nr flex justify-between",onClick:m[2]||(m[2]=e=>{var a;return $(o)(null==(a=f.value)?void 0:a.sn)})},{default:u((()=>[r(y,{class:"label"},{default:u((()=>[i("用户ID")])),_:1}),r(y,{class:"content"},{default:u((()=>{var e;return[i(n(null==(e=f.value)?void 0:e.sn),1)]})),_:1}),r(g,{name:"arrow-right",size:"22",color:"#666"})])),_:1}),c(" 手机号 "),r(y,{class:"item text-nr flex justify-between"},{default:u((()=>[r(y,{class:"label"},{default:u((()=>[i("手机号")])),_:1}),r(y,{class:"content"},{default:u((()=>{var e,a;return[i(n(""==(null==(e=f.value)?void 0:e.mobile)?"未绑定手机号":null==(a=f.value)?void 0:a.mobile),1)]})),_:1}),r(w,{onClick:m[3]||(m[3]=e=>le.value=!0),size:"mini",type:"primary",shape:"circle",plain:!0},{default:u((()=>{var e;return[i(n(""==(null==(e=f.value)?void 0:e.mobile)?"绑定手机号":"更换手机号"),1)]})),_:1})])),_:1}),c(" 注册时间 "),r(y,{class:"item text-nr flex justify-between"},{default:u((()=>[r(y,{class:"label"},{default:u((()=>[i("注册时间")])),_:1}),r(y,{class:"content"},{default:u((()=>{var e;return[i(n(null==(e=f.value)?void 0:e.create_time),1)]})),_:1})])),_:1}),c(" 微信绑定 "),Ce.value?(l(),s(y,{key:0,class:"item text-nr flex justify-between",onClick:Ie},{default:u((()=>{var e;return[r(y,{class:"label"},{default:u((()=>[i("微信绑定")])),_:1}),r(y,{class:"content"},{default:u((()=>{var e;return[i(n(0==(null==(e=f.value)?void 0:e.has_auth)?"未绑定":"已绑定"),1)]})),_:1}),0==(null==(e=f.value)?void 0:e.has_auth)?(l(),s(g,{key:0,name:"arrow-right",size:"22",color:"#666"})):c("v-if",!0)]})),_:1})):c("v-if",!0)])),_:1})])),_:1}),c(" 登录密码 "),r(y,{class:"text-nr flex justify-between mt-[10rpx] px-[30rpx] bg-white h-[100rpx] items-center",onClick:we},{default:u((()=>[r(y,{class:""},{default:u((()=>[i("登录密码")])),_:1}),r(g,{name:"arrow-right",color:"#666"})])),_:1}),c(" 注销账号 "),(null==(e=f.value)?void 0:e.is_cancelled)?(l(),s(y,{key:0,class:"text-nr flex justify-between mt-[10rpx] px-[30rpx] bg-white h-[100rpx] items-center",onClick:ge},{default:u((()=>[r(y,{class:"label"},{default:u((()=>[i("注销账号")])),_:1}),r(g,{name:"arrow-right",size:"22",color:"#666"})])),_:1})):c("v-if",!0),c(" 退出登录 "),r(y,{class:"item text-nr flex justify-center items-center mt-[10rpx] px-[30rpx] bg-white h-[100rpx]",onClick:Ve},{default:u((()=>[i(" 退出登录 ")])),_:1}),c(" 昵称修改组件 "),r(j,{modelValue:x.value,"onUpdate:modelValue":m[4]||(m[4]=e=>x.value=e),closeable:!0,mode:"center",maskCloseAble:!1,"border-radius":"20"},{default:u((()=>[r(y,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:u((()=>[r(I,{onSubmit:ye},{default:u((()=>[r(y,{class:"mb-[70rpx] text-xl text-center"},{default:u((()=>[i(" 修改昵称 ")])),_:1}),r(V,{borderBottom:""},{default:u((()=>[r(k,{class:"nr h-[60rpx] w-full",value:f.value.nickname,name:"nickname",type:"nickname",placeholder:"请输入昵称"},null,8,["value"])])),_:1}),r(y,{class:"mt-[80rpx]"},{default:u((()=>[r(C,{"form-type":"submit",class:"bg-primary rounded-full h-[80rpx] text-lg leading-[80rpx] text-btn-text"},{default:u((()=>[i(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),c(" 账号修改组件 "),r(j,{modelValue:_.value,"onUpdate:modelValue":m[6]||(m[6]=e=>_.value=e),closeable:!0,mode:"center","border-radius":"20"},{default:u((()=>[r(y,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:u((()=>[r(y,{class:"mb-[70rpx] text-xl text-center"},{default:u((()=>[i("修改账号")])),_:1}),r(V,{borderBottom:""},{default:u((()=>[r(B,{class:"flex-1",modelValue:re.value,"onUpdate:modelValue":m[5]||(m[5]=e=>re.value=e),placeholder:"请输入账号",border:!1},null,8,["modelValue"])])),_:1}),r(y,{class:"mt-[80rpx]"},{default:u((()=>[r(w,{onClick:be,type:"primary",shape:"circle"},{default:u((()=>[i(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),c(" 账号修改组件 "),r(j,{modelValue:le.value,"onUpdate:modelValue":m[9]||(m[9]=e=>le.value=e),closeable:!0,mode:"center","border-radius":"20"},{default:u((()=>[r(y,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:u((()=>[r(y,{class:"mb-[70rpx] text-xl text-center"},{default:u((()=>[i(" 修改手机号码 ")])),_:1}),r(V,{borderBottom:""},{default:u((()=>[r(B,{class:"flex-1",modelValue:ie.value,"onUpdate:modelValue":m[7]||(m[7]=e=>ie.value=e),placeholder:"请输入新的手机号码",border:!1},null,8,["modelValue"])])),_:1}),r(V,{borderBottom:""},{default:u((()=>[r(B,{class:"flex-1",modelValue:ne.value,"onUpdate:modelValue":m[8]||(m[8]=e=>ne.value=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),r(y,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3 w-[180rpx]",onClick:fe},{default:u((()=>[r(z,{ref_key:"uCodeRef",ref:de,seconds:60,onChange:me,"change-text":"x秒"},null,512),i(" "+n(ce.value),1)])),_:1})])),_:1}),r(y,{class:"mt-[80rpx]"},{default:u((()=>[r(w,{onClick:he,type:"primary",shape:"circle"},{default:u((()=>[i(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),c("    选择密码    "),r(A,{list:ue.value,modelValue:se.value,"onUpdate:modelValue":m[10]||(m[10]=e=>se.value=e),onClick:ke,"safe-area-inset-bottom":!0},null,8,["list","modelValue"])]})),_:1})],64)}}}),[["__scopeId","data-v-8ed76438"]]);export{le as default};
