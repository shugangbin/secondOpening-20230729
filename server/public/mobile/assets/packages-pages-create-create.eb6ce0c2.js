import{cd as e,ce as t,cf as l,cg as a,ch as o,ci as u,cj as r,ck as s,cl as n,ac as i,cm as c,cn as d,co as m,cp as p,cq as f,cr as h,cs as v,ct as _,cu as y,cv as b,cw as x,cx as g,cy as V,cz as j,cA as w,cB as k,d as S,c as C,a as A,b as N,o as I,e as D,f as U,g as B,bX as O,u as $,m as L,h as q,t as z,j as T,k as W,_ as M,p as P,i as R,F,l as E,n as H,s as Z,y as G,c0 as J,c1 as K,r as X,B as Y,w as Q,a1 as ee,x as te,W as le,M as ae,L as oe,J as ue,A as re,K as se,bV as ne}from"./index-5fd89c82.js";import{_ as ie}from"./page-meta.e1766212.js";import{_ as ce}from"./u-image.adbe7f0a.js";import{_ as de}from"./u-form-item.2be3ee00.js";import{_ as me}from"./u-form.7e2aef85.js";import{_ as pe}from"./u-input.89121eb6.js";import{_ as fe}from"./u-icon.a1449c4b.js";import{_ as he}from"./u-popup.f70e8582.js";import{_ as ve,a as _e}from"./create_record.9e9c67d9.js";import{_ as ye}from"./u-button.ea6057e5.js";import{_ as be}from"./u-picker.81fd0f22.js";import{o as xe,f as ge,p as Ve}from"./chat.b5adffe9.js";import{u as je,w as we}from"./index.3e35f6de.js";import{u as ke}from"./useCopy.dbed25b8.js";import"./emitter.1571a5d9.js";import"./text-item.vue_vue_type_script_setup_true_lang.eddf7716.js";import"./_commonjsHelpers.8b4586d6.js";const Se=e(t,"WeakMap");const Ce=l(Object.keys,Object);var Ae=Object.prototype.hasOwnProperty;function Ne(e){return o(e)?u(e):function(e){if(!a(e))return Ce(e);var t=[];for(var l in Object(e))Ae.call(e,l)&&"constructor"!=l&&t.push(l);return t}(e)}function Ie(e,t){for(var l=-1,a=t.length,o=e.length;++l<a;)e[o+l]=t[l];return e}function De(){return[]}var Ue=Object.prototype.propertyIsEnumerable,Be=Object.getOwnPropertySymbols;const Oe=Be?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var l=-1,a=null==e?0:e.length,o=0,u=[];++l<a;){var r=e[l];t(r,l,e)&&(u[o++]=r)}return u}(Be(e),(function(t){return Ue.call(e,t)})))}:De;const $e=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ie(t,Oe(e)),e=n(e);return t}:De;function Le(e,t,l){var a=t(e);return i(e)?a:Ie(a,l(e))}function qe(e){return Le(e,Ne,Oe)}function ze(e){return Le(e,s,$e)}const Te=e(t,"DataView");const We=e(t,"Promise");const Me=e(t,"Set");var Pe="[object Map]",Re="[object Promise]",Fe="[object Set]",Ee="[object WeakMap]",He="[object DataView]",Ze=c(Te),Ge=c(m),Je=c(We),Ke=c(Me),Xe=c(Se),Ye=d;(Te&&Ye(new Te(new ArrayBuffer(1)))!=He||m&&Ye(new m)!=Pe||We&&Ye(We.resolve())!=Re||Me&&Ye(new Me)!=Fe||Se&&Ye(new Se)!=Ee)&&(Ye=function(e){var t=d(e),l="[object Object]"==t?e.constructor:void 0,a=l?c(l):"";if(a)switch(a){case Ze:return He;case Ge:return Pe;case Je:return Re;case Ke:return Fe;case Xe:return Ee}return t});const Qe=Ye;var et=Object.prototype.hasOwnProperty;var tt=/\w*$/;var lt=f?f.prototype:void 0,at=lt?lt.valueOf:void 0;var ot="[object Boolean]",ut="[object Date]",rt="[object Map]",st="[object Number]",nt="[object RegExp]",it="[object Set]",ct="[object String]",dt="[object Symbol]",mt="[object ArrayBuffer]",pt="[object DataView]",ft="[object Float32Array]",ht="[object Float64Array]",vt="[object Int8Array]",_t="[object Int16Array]",yt="[object Int32Array]",bt="[object Uint8Array]",xt="[object Uint8ClampedArray]",gt="[object Uint16Array]",Vt="[object Uint32Array]";function jt(e,t,l){var a,o,u,r=e.constructor;switch(t){case mt:return p(e);case ot:case ut:return new r(+e);case pt:return function(e,t){var l=t?p(e.buffer):e.buffer;return new e.constructor(l,e.byteOffset,e.byteLength)}(e,l);case ft:case ht:case vt:case _t:case yt:case bt:case xt:case gt:case Vt:return h(e,l);case rt:return new r;case st:case ct:return new r(e);case nt:return(u=new(o=e).constructor(o.source,tt.exec(o))).lastIndex=o.lastIndex,u;case it:return new r;case dt:return a=e,at?Object(at.call(a)):{}}}var wt=_&&_.isMap;const kt=wt?y(wt):function(e){return v(e)&&"[object Map]"==Qe(e)};var St=_&&_.isSet;const Ct=St?y(St):function(e){return v(e)&&"[object Set]"==Qe(e)};var At=1,Nt=2,It=4,Dt="[object Arguments]",Ut="[object Function]",Bt="[object GeneratorFunction]",Ot="[object Object]",$t={};function Lt(e,t,l,a,o,u){var n,c=t&At,d=t&Nt,m=t&It;if(l&&(n=o?l(e,a,o,u):l(e)),void 0!==n)return n;if(!b(e))return e;var p=i(e);if(p){if(n=function(e){var t=e.length,l=new e.constructor(t);return t&&"string"==typeof e[0]&&et.call(e,"index")&&(l.index=e.index,l.input=e.input),l}(e),!c)return x(e,n)}else{var f=Qe(e),h=f==Ut||f==Bt;if(g(e))return V(e,c);if(f==Ot||f==Dt||h&&!o){if(n=d||h?{}:j(e),!c)return d?function(e,t){return r(e,$e(e),t)}(e,function(e,t){return e&&r(t,s(t),e)}(n,e)):function(e,t){return r(e,Oe(e),t)}(e,function(e,t){return e&&r(t,Ne(t),e)}(n,e))}else{if(!$t[f])return o?e:{};n=jt(e,f,c)}}u||(u=new w);var v=u.get(e);if(v)return v;u.set(e,n),Ct(e)?e.forEach((function(a){n.add(Lt(a,t,l,a,e,u))})):kt(e)&&e.forEach((function(a,o){n.set(o,Lt(a,t,l,o,e,u))}));var _=p?void 0:(m?d?ze:qe:d?s:Ne)(e);return function(e,t){for(var l=-1,a=null==e?0:e.length;++l<a&&!1!==t(e[l],l,e););}(_||e,(function(a,o){_&&(a=e[o=a]),k(n,o,Lt(a,t,l,o,e,u))})),n}$t[Dt]=$t["[object Array]"]=$t["[object ArrayBuffer]"]=$t["[object DataView]"]=$t["[object Boolean]"]=$t["[object Date]"]=$t["[object Float32Array]"]=$t["[object Float64Array]"]=$t["[object Int8Array]"]=$t["[object Int16Array]"]=$t["[object Int32Array]"]=$t["[object Map]"]=$t["[object Number]"]=$t[Ot]=$t["[object RegExp]"]=$t["[object Set]"]=$t["[object String]"]=$t["[object Symbol]"]=$t["[object Uint8Array]"]=$t["[object Uint8ClampedArray]"]=$t["[object Uint16Array]"]=$t["[object Uint32Array]"]=!0,$t["[object Error]"]=$t[Ut]=$t["[object WeakMap]"]=!1;function qt(e){return Lt(e,5)}const zt=M(S({__name:"input",props:{modelValue:{default:""},placeholder:{default:"请输入"},showWordLimit:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,a=C({get:()=>l.modelValue,set(e){t("update:modelValue",e)}});return(t,l)=>{const o=A(N("u-input"),pe),u=W;return I(),D(u,{class:"widget-input"},{default:U((()=>[B(o,O({class:"flex-1 min-w-0",modelValue:$(a),"onUpdate:modelValue":l[0]||(l[0]=e=>L(a)?a.value=e:null),placeholder:e.placeholder,height:"70","placeholder-style":"color: #999"},t.$attrs),null,16,["modelValue","placeholder"]),e.showWordLimit?(I(),D(u,{key:0,class:"text-xs text-muted ml-[20rpx]"},{default:U((()=>{var e;return[q(z(null==(e=$(a))?void 0:e.length)+" / "+z(t.$attrs.maxlength),1)]})),_:1})):T("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-7a66ad0d"]]),Tt=M(S({__name:"textarea",props:{modelValue:{default:""},placeholder:{default:"请输入"},rows:{default:1},showWordLimit:{type:Boolean,default:!0},autosize:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,a=C({get:()=>l.modelValue,set(e){t("update:modelValue",e)}}),o=C((()=>({height:l.autosize?"auto":40*l.rows+"rpx",minHeight:"80rpx",fontSize:"28rpx"})));return(t,l)=>{const u=A(N("u-input"),pe),r=W;return I(),D(r,{class:"widget-textarea"},{default:U((()=>[B(u,{class:"w-full",modelValue:$(a),"onUpdate:modelValue":l[0]||(l[0]=e=>L(a)?a.value=e:null),placeholder:e.placeholder,"auto-height":e.autosize,"custom-style":$(o),"placeholder-style":"color: #999",maxlength:t.$attrs.maxlength,type:"textarea"},null,8,["modelValue","placeholder","auto-height","custom-style","maxlength"]),e.showWordLimit?(I(),D(r,{key:0,class:"text-xs bg-page text-muted absolute right-[20rpx] bottom-[10rpx] leading-[28rpx]"},{default:U((()=>{var e;return[q(z(null==(e=$(a))?void 0:e.length)+" / "+z(t.$attrs.maxlength),1)]})),_:1})):T("v-if",!0)])),_:1})}}}),[["__scopeId","data-v-73261fcb"]]),Wt=M(S({__name:"radio",props:{defaultValue:null,modelValue:{default:""},options:{default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,a=C({get:()=>l.modelValue,set(e){t("update:modelValue",e)}});return P((()=>{l.defaultValue&&(a.value=l.defaultValue)})),(t,l)=>{const o=W;return I(),D(o,{class:"widget-radio"},{default:U((()=>[B(o,{class:"radio-group"},{default:U((()=>[(I(!0),R(F,null,E(e.options,((e,t)=>(I(),D(o,{class:H(["radio-item",{"radio-item--active":$(a)===e}]),key:t,onClick:t=>a.value=e},{default:U((()=>[q(z(e),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})}}}),[["__scopeId","data-v-5867098a"]]);const Mt=M({emits:["update:modelValue","input","confirm"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},list:{type:Array,default:()=>[]},border:{type:Boolean,default:!0},cancelColor:{type:String,default:"#606266"},confirmColor:{type:String,default:"#2979ff"},zIndex:{type:[String,Number],default:0},safeAreaInsetBottom:{type:Boolean,default:!1},maskCloseAble:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[0]},mode:{type:String,default:"single-column"},valueName:{type:String,default:"value"},labelName:{type:String,default:"label"},childName:{type:String,default:"children"},title:{type:String,default:""},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确认"},blur:{type:[Number,String],default:0}},data:()=>({popupValue:!1,defaultSelector:[0],columnData:[],selectValue:[],lastSelectIndex:[],columnNum:0,moving:!1}),watch:{value:{immediate:!0,handler(e){e&&setTimeout((()=>this.init()),10),this.popupValue=e}},modelValue:{immediate:!0,handler(e){e&&setTimeout((()=>this.init()),10),this.popupValue=e}}},computed:{uZIndex(){return this.zIndex?this.zIndex:this.$u.zIndex.popup}},methods:{pickstart(){},pickend(){},init(){this.setColumnNum(),this.setDefaultSelector(),this.setColumnData(),this.setSelectValue()},setDefaultSelector(){this.defaultSelector=this.defaultValue.length==this.columnNum?this.defaultValue:Array(this.columnNum).fill(0),this.lastSelectIndex=this.$u.deepClone(this.defaultSelector)},setColumnNum(){if("single-column"==this.mode)this.columnNum=1;else if("mutil-column"==this.mode)this.columnNum=this.list.length;else if("mutil-column-auto"==this.mode){let e=1,t=this.list;for(;t[0][this.childName];)t=t[0]?t[0][this.childName]:{},e++;this.columnNum=e}},setColumnData(){let e=[];if(this.selectValue=[],"mutil-column-auto"==this.mode){let t=this.list[this.defaultSelector.length?this.defaultSelector[0]:0];for(let l=0;l<this.columnNum;l++)0==l?(e[l]=this.list,t=t[this.childName]):(e[l]=t,t=t[this.defaultSelector[l]][this.childName])}else"single-column"==this.mode?e[0]=this.list:e=this.list;this.columnData=e},setSelectValue(){let e=null;for(let t=0;t<this.columnNum;t++){e=this.columnData[t][this.defaultSelector[t]];let l={value:e?e[this.valueName]:null,label:e?e[this.labelName]:null};e&&e.extra&&(l.extra=e.extra),this.selectValue.push(l)}},columnChange(e){let t=null,l=e.detail.value;if(this.selectValue=[],"mutil-column-auto"==this.mode){this.lastSelectIndex.map(((e,a)=>{e!=l[a]&&(t=a)})),this.defaultSelector=l;for(let e=t+1;e<this.columnNum;e++)this.columnData[e]=this.columnData[e-1][e-1==t?l[t]:0][this.childName],this.defaultSelector[e]=0;l.map(((e,t)=>{let a=this.columnData[t][l[t]],o={value:a?a[this.valueName]:null,label:a?a[this.labelName]:null};a&&void 0!==a.extra&&(o.extra=a.extra),this.selectValue.push(o)})),this.lastSelectIndex=l}else if("single-column"==this.mode){let e=this.columnData[0][l[0]],t={value:e?e[this.valueName]:null,label:e?e[this.labelName]:null};e&&void 0!==e.extra&&(t.extra=e.extra),this.selectValue.push(t)}else"mutil-column"==this.mode&&l.map(((e,t)=>{let a=this.columnData[t][l[t]],o={value:a?a[this.valueName]:null,label:a?a[this.labelName]:null};a&&void 0!==a.extra&&(o.extra=a.extra),this.selectValue.push(o)}))},close(){this.$emit("input",!1),this.$emit("update:modelValue",!1)},getResult(e=null){e&&this.$emit(e,this.selectValue),this.close()},selectHandler(){this.$emit("click")}}},[["render",function(e,t,l,a,o,u){const r=W,s=J,n=K,i=A(N("u-popup"),he);return I(),D(r,{class:"u-select"},{default:U((()=>[T(' <view class="u-select__action" :class="{\r\n\t\t\t\'u-select--border\': border\r\n\t\t}" @tap.stop="selectHandler">\r\n\t\t\t<view class="u-select__action__icon" :class="{\r\n\t\t\t\t\'u-select__action__icon--reverse\': value == true\r\n\t\t\t}">\r\n\t\t\t\t<u-icon name="arrow-down-fill" size="26" color="#c0c4cc"></u-icon>\r\n\t\t\t</view>\r\n\t\t</view> '),B(i,{blur:l.blur,maskCloseAble:l.maskCloseAble,mode:"bottom",popup:!1,modelValue:o.popupValue,"onUpdate:modelValue":t[4]||(t[4]=e=>o.popupValue=e),length:"auto",safeAreaInsetBottom:l.safeAreaInsetBottom,onClose:u.close,"z-index":u.uZIndex},{default:U((()=>[B(r,{class:"u-select"},{default:U((()=>[B(r,{class:"u-select__header",onTouchmove:t[3]||(t[3]=Z((()=>{}),["stop","prevent"]))},{default:U((()=>[B(r,{class:"u-select__header__cancel u-select__header__btn",style:G({color:l.cancelColor}),"hover-class":"u-hover-class","hover-stay-time":150,onClick:t[0]||(t[0]=e=>u.getResult("cancel"))},{default:U((()=>[q(z(l.cancelText),1)])),_:1},8,["style"]),B(r,{class:"u-select__header__title"},{default:U((()=>[q(z(l.title),1)])),_:1}),B(r,{class:"u-select__header__confirm u-select__header__btn",style:G({color:o.moving?l.cancelColor:l.confirmColor}),"hover-class":"u-hover-class","hover-stay-time":150,onTouchmove:t[1]||(t[1]=Z((()=>{}),["stop"])),onClick:t[2]||(t[2]=Z((e=>u.getResult("confirm")),["stop"]))},{default:U((()=>[q(z(l.confirmText),1)])),_:1},8,["style"])])),_:1}),B(r,{class:"u-select__body"},{default:U((()=>[B(n,{onChange:u.columnChange,class:"u-select__body__picker-view",value:o.defaultSelector,onPickstart:u.pickstart,onPickend:u.pickend},{default:U((()=>[(I(!0),R(F,null,E(o.columnData,((e,t)=>(I(),D(s,{key:t},{default:U((()=>[(I(!0),R(F,null,E(e,((e,t)=>(I(),D(r,{class:"u-select__body__picker-view__item",key:t},{default:U((()=>[B(r,{class:"u-line-1"},{default:U((()=>[q(z(e[l.labelName]),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1},8,["onChange","value","onPickstart","onPickend"])])),_:1})])),_:1})])),_:1},8,["blur","maskCloseAble","modelValue","safeAreaInsetBottom","onClose","z-index"])])),_:1})}],["__scopeId","data-v-6d36d0a6"]]),Pt=M(S({__name:"select",props:{defaultValue:null,modelValue:{default:""},options:{default:()=>[]},placeholder:{default:"请输入"}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,a=C({get:()=>l.modelValue,set(e){t("update:modelValue",e)}}),o=X(!1),u=C((()=>l.options.map((e=>({value:e,label:e}))))),r=e=>{a.value=e[0].value};return P((()=>{l.defaultValue&&(a.value=l.defaultValue)})),(t,l)=>{const s=A(N("u-input"),pe),n=W,i=A(N("u-icon"),fe),c=A(N("u-select"),Mt);return I(),R(F,null,[B(n,{class:"widget-select"},{default:U((()=>[B(n,{class:"flex-1"},{default:U((()=>[B(s,{modelValue:$(a),"onUpdate:modelValue":l[0]||(l[0]=e=>L(a)?a.value=e:null),height:"70",placeholder:e.placeholder,type:"text","placeholder-style":"color: #999",disabled:"",clearable:"",onClick:l[1]||(l[1]=e=>o.value=!0)},null,8,["modelValue","placeholder"])])),_:1}),B(n,{class:H(["text-muted arrow-icon",{"arrow-icon--top":o.value}])},{default:U((()=>[B(i,{name:"arrow-down"})])),_:1},8,["class"])])),_:1}),B(c,{modelValue:o.value,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value=e),list:$(u),onConfirm:r},null,8,["modelValue","list"])],64)}}}),[["__scopeId","data-v-228b30d9"]]),Rt=M(S({__name:"checkbox",props:{defaultValue:null,modelValue:{default:()=>[]},options:{default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,a=C({get:()=>l.modelValue,set(e){t("update:modelValue",e)}}),o=e=>a.value.includes(e);return P((()=>{l.defaultValue&&(a.value=l.defaultValue)})),(t,l)=>{const u=W;return I(),D(u,{class:"widget-radio"},{default:U((()=>[B(u,{class:"radio-group"},{default:U((()=>[(I(!0),R(F,null,E(e.options,((e,t)=>(I(),D(u,{class:H(["radio-item",{"radio-item--active":o(e)}]),key:t,onClick:t=>(e=>{var t,l,o;const u=null==(t=a.value)?void 0:t.findIndex((t=>e===t));-1===u?null==(l=a.value)||l.push(e):null==(o=a.value)||o.splice(u,1)})(e)},{default:U((()=>[q(z(e),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})}}}),[["__scopeId","data-v-565a07af"]]),Ft=S({__name:"form-designer",props:{formLists:{default:()=>[]},modelValue:null,labelPosition:{default:"top"},borderBottom:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{expose:t,emit:l}){const a=e,o=Y(),u=C({get:()=>a.modelValue,set(e){l("update:modelValue",e)}}),r=X({});return Q((()=>a.formLists),(e=>{r.value=null==e?void 0:e.reduce(((e,t)=>(t.props.isRequired&&(e[t.id]=[{required:!0}]),e)),{}),ee((()=>{var e;null==(e=o.value)||e.setRules(r.value)}))}),{immediate:!0}),t({validate:async()=>new Promise(((e,t)=>{var l;null==(l=o.value)||l.validate((l=>{l?e(!0):t()}))}))}),(t,l)=>{const s=A(N("u-form-item"),de),n=A(N("u-form"),me);return I(),D(n,O({model:$(u),ref_key:"formRef",ref:o},{...t.$attrs,...a},{"error-type":["none"],rules:r.value}),{default:U((()=>[(I(!0),R(F,null,E(e.formLists,(t=>(I(),D(s,{key:t.id,prop:t.id,label:t.props.title,borderBottom:e.borderBottom,required:t.props.isRequired},{default:U((()=>["WidgetInput"===t.name?(I(),D(zt,O({key:0,class:"w-full"},t.props,{modelValue:$(u)[t.id],"onUpdate:modelValue":e=>$(u)[t.id]=e}),null,16,["modelValue","onUpdate:modelValue"])):"WidgetTextarea"===t.name?(I(),D(Tt,O({key:1,class:"w-full"},t.props,{modelValue:$(u)[t.id],"onUpdate:modelValue":e=>$(u)[t.id]=e}),null,16,["modelValue","onUpdate:modelValue"])):"WidgetRadio"===t.name?(I(),D(Wt,O({key:2},t.props,{modelValue:$(u)[t.id],"onUpdate:modelValue":e=>$(u)[t.id]=e}),null,16,["modelValue","onUpdate:modelValue"])):"WidgetSelect"===t.name?(I(),D(Pt,O({key:3,class:"w-full"},t.props,{modelValue:$(u)[t.id],"onUpdate:modelValue":e=>$(u)[t.id]=e}),null,16,["modelValue","onUpdate:modelValue"])):"WidgetCheckbox"===t.name?(I(),D(Rt,O({key:4},t.props,{modelValue:$(u)[t.id],"onUpdate:modelValue":e=>$(u)[t.id]=e}),null,16,["modelValue","onUpdate:modelValue"])):T("v-if",!0)])),_:2},1032,["prop","label","borderBottom","required"])))),128))])),_:1},16,["model","rules"])}}}),Et=(e,t="yyyy-mm-dd")=>{e||(e=Number(new Date)),10==e.toString().length&&(e*=1e3);const l=new Date(e);let a;const o={"y+":l.getFullYear().toString(),"m+":(l.getMonth()+1).toString(),"d+":l.getDate().toString(),"h+":l.getHours().toString(),"M+":l.getMinutes().toString(),"s+":l.getSeconds().toString()};for(const u in o)a=new RegExp(`(${u})`).exec(t),a&&(t=t.replace(a[1],1==a[1].length?o[u]:o[u].padStart(a[1].length,"0")));return t},Ht=S({__name:"create",setup(e){const t=[{name:"WidgetTextarea",title:"多行文本",id:"question",props:{title:"内容描述",placeholder:"",rows:8,maxlength:400,autosize:!1,isRequired:!1}}],l=te(),{copy:a}=ke(),o=le({id:0,type:1,token:""}),u=Y(),r=Y(),s=X([]),n=X({}),i=X({}),c=X([]),d=le({show:!1,current:{balance:1,key:"",member_free:!1,model:"",default:!1},modelList:[]});(async()=>{try{const e=await xe();d.modelList=e,d.current=e.find((e=>e.default))||e[0]}catch(e){console.log("获取聊天模型数据错误=>",e)}})();const m=e=>{d.current=d.modelList[e[0]]},p=X(!1),f=()=>{var e;if(n.value.question)return n.value.question;const t=(null==(e=i.value)?void 0:e.form[0])||{};return`${t.props.title}：${n.value[t.id]||""}`},h=async()=>{var e,t;try{await(null==(e=u.value)?void 0:e.validate())}catch(a){return void uni.$u.toast("必填项不能为空")}try{p.value=!0,await Ve({model:(null==(t=null==d?void 0:d.current)?void 0:t.key)||"",other_id:o.id,form:n.value.question?void 0:n.value,question:n.value.question,type:2},{onstart(e){s.value.length&&(s.value=[])},onmessage(e){e.trim().split("data:").forEach((e=>{if(""!==e)try{const t=JSON.parse(e),{id:l,event:a,data:o,index:u}=t;let r=s.value.findIndex((e=>e.id===l));if(-1===r&&(s.value.push({create_time:Et(new Date,"yyyy-mm-dd hh:MM:ss"),title:n.value.question?n.value.question:f(),reply:[],id:l}),r=s.value.length-1),o&&(s.value[r].reply[u]||(s.value[r].reply[u]=""),s.value[r].reply[u]+=o),"finish"===a)return}catch(a){}}))},onclose(){setTimeout((()=>{p.value=!1}),1e3)}})}catch(a){if(p.value=!1,"会员余额不足"===a&&l.getIsShowVip){(await oe({title:"会员余额不足",content:"开通会员，享受更多权益，VIP期间不消耗次数，次数永不过期",confirmText:"前往开通"})).confirm&&v()}}},v=()=>{b.navigateTo({path:"/packages/pages/open_vip/open_vip"})},_=()=>{var e;null==(e=i.value)||e.form.forEach((e=>{e.props.placeholder&&!e.props.defaultValue&&(n.value[e.id]=e.props.placeholder)}))},y=()=>{var e;null==(e=i.value)||e.form.forEach((e=>{e.props.defaultValue?n.value[e.id]=qt(e.props.defaultValue):n.value[e.id]=void 0}))},b=ue(),x=()=>b.navigateTo({path:"/packages/pages/create_history/create_history",query:{id:o.id}}),{height:g}=je(r);return we(g,(()=>{p.value&&ne({selector:"#bottom-line",duration:0})}),{throttle:200}),ae((async e=>{o.id=Number(null==e?void 0:e.id),o.type=Number(null==e?void 0:e.type),await(async()=>{const e=await ge({id:o.id});i.value=e,i.value.form||(i.value.form=t),c.value=qt(i.value.form),y()})()})),(e,t)=>{const l=A(N("page-meta"),ie),o=A(N("u-image"),ce),f=W,v=A(N("form-designer"),Ft),b=A(N("creation-history-item"),_e),g=re,V=se,j=A(N("u-icon"),fe),w=A(N("u-button"),ye),k=A(N("u-picker"),be);return I(),R(F,null,[B(l,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),i.value.name?(I(),D(f,{key:0,class:"safe-area-inset-bottom"},{default:U((()=>[B(f,{class:"pt-[20rpx] pb-[160rpx]"},{default:U((()=>[B(f,{class:"px-[20rpx]"},{default:U((()=>[B(f,{class:"px-[30rpx] py-[24rpx] flex rounded-[14rpx] bg-white items-center"},{default:U((()=>[B(o,{src:i.value.image,width:"84",height:"84"},null,8,["src"]),B(f,{class:"flex-1 min-w-0 ml-[20rpx]"},{default:U((()=>[B(f,{class:"text-xl font-medium"},{default:U((()=>[q(z(i.value.name),1)])),_:1}),i.value.tips?(I(),D(f,{key:0,class:"text-content line-clamp-2 text-xs mt-[10rpx]"},{default:U((()=>[q(z(i.value.tips),1)])),_:1})):T("v-if",!0)])),_:1})])),_:1}),B(f,{class:"px-[30rpx] py-[24rpx] rounded-[14rpx] bg-white mt-[20rpx]"},{default:U((()=>[B(v,{ref_key:"formDesignerRef",ref:u,formLists:c.value,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["formLists","modelValue"]),B(f,{class:"bg-[#FFFAF0] text-xs rounded-full inline-block px-[30rpx] py-[14rpx] text-[#FD984E] mt-[10rpx]",onClick:_},{default:U((()=>[q(" 不知道写啥？点击插入示例 👈🏻 ")])),_:1})])),_:1})])),_:1}),B(f,null,{default:U((()=>[B(f,{class:"flex items-center px-[20rpx] py-[30rpx]"},{default:U((()=>[B(f,{class:"text-lg font-medium mr-auto"},{default:U((()=>[q(" 本次创作结果 ")])),_:1}),B(f,{class:"text-content",onClick:x},{default:U((()=>[q(" 创作历史 ")])),_:1})])),_:1}),B(f,null,{default:U((()=>[B(f,{class:"current-history",ref_key:"currentHistoryRef",ref:r},{default:U((()=>[B(f,{class:"px-[20rpx]"},{default:U((()=>[(I(!0),R(F,null,E(s.value,(e=>(I(),D(f,{class:"mt-[20rpx]",key:e.id},{default:U((()=>[B(b,{title:e.title,time:e.create_time,content:e.reply,showDelete:!1,onCopy:$(a)},null,8,["title","time","content","onCopy"])])),_:2},1024)))),128))])),_:1})])),_:1},512)])),_:1})])),_:1}),s.value.length?T("v-if",!0):(I(),D(f,{key:0,class:"flex flex-col justify-center items-center pb-[200rpx]"},{default:U((()=>[B(g,{class:"w-[300rpx] h-[300rpx]",src:ve,alt:""}),B(f,{class:"my-[32rpx] font-medium"},{default:U((()=>[q(" AI创作结果会在显示这里，现在你只需要 ")])),_:1}),B(f,null,{default:U((()=>[B(f,{class:"text-content text-sm"},{default:U((()=>[q(" 1.填写越详细，结果越准确哦 ")])),_:1}),B(f,{class:"text-content text-sm"},{default:U((()=>[q(" 2.点击立即生成按钮，一般在10秒内搞定 ")])),_:1})])),_:1})])),_:1}))])),_:1}),B(f,{id:"bottom-line",class:"h-[1px]"}),B(f,{class:"safe-area-inset-bottom fixed bottom-0 left-0 w-full bg-white z-10"},{default:U((()=>[B(f,{class:"p-[20rpx]"},{default:U((()=>[T(" 模型选择 "),d.modelList.length?(I(),D(f,{key:0,class:"flex items-center justify-between text-xs pb-[20rpx]"},{default:U((()=>{var e;return[B(f,{class:"inline-flex justify-center items-center rounded-[30px] h-[60rpx] px-[24rpx]",style:{"box-shadow":"0 2px 6px 0 rgba(0, 0, 0, 0.1)"},onClick:t[1]||(t[1]=e=>d.show=!0)},{default:U((()=>[B(V,{class:"text-[#415058] mr-[6px]"},{default:U((()=>[q(z(d.current.alias),1)])),_:1}),B(j,{name:"arrow-down",size:"24rpx"})])),_:1}),(null==(e=null==d?void 0:d.current)?void 0:e.member_free)?(I(),D(f,{key:1,class:"ml-[10px] text-[#999999]"},{default:U((()=>[q(" 已开通会员，不消耗条数 ")])),_:1})):(I(),D(f,{key:0,class:"ml-[10px] text-[#999999]"},{default:U((()=>[B(V,null,{default:U((()=>[q("消耗 ")])),_:1}),B(V,{class:"text-primary"},{default:U((()=>{var e;return[q(z((null==(e=null==d?void 0:d.current)?void 0:e.balance)||0),1)]})),_:1}),B(V,null,{default:U((()=>[q(" 条对话次数")])),_:1})])),_:1}))]})),_:1})):T("v-if",!0),B(f,{class:"flex"},{default:U((()=>[B(f,{class:"w-[40%]"},{default:U((()=>[B(w,{hairLine:!1,"custom-style":{width:"100%",border:"none",background:"#f5f5f5"},onClick:y},{default:U((()=>[B(j,{name:"trash"}),q(" 重置内容 ")])),_:1})])),_:1}),B(f,{class:"flex-1 ml-[20rpx]"},{default:U((()=>[B(w,{type:"primary",loading:p.value,"custom-style":{width:"100%"},onClick:h},{default:U((()=>[q(" 立即生成 ")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1}),B(k,{modelValue:d.show,"onUpdate:modelValue":t[2]||(t[2]=e=>d.show=e),"safe-area-inset-bottom":!0,"confirm-color":e.$theme.primaryColor,mode:"selector",range:d.modelList,"range-key":"alias",onConfirm:m},null,8,["modelValue","confirm-color","range"])])),_:1})):T("v-if",!0)],64)}}});export{Ht as default};
